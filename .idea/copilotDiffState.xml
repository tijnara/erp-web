<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/vos-erp/src/app/api/lookup/[resource]/route.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/vos-erp/src/app/api/lookup/[resource]/route.ts" />
              <option name="originalContent" value="// src/app/api/lookup/[resource]/route.ts&#10;export const runtime = &quot;nodejs&quot;;&#10;&#10;import { NextRequest, NextResponse } from &quot;next/server&quot;;&#10;import { cookies as nextCookies } from &quot;next/headers&quot;;&#10;import { createClient } from &quot;@supabase/supabase-js&quot;;&#10;&#10;const ACCESS = process.env.AUTH_ACCESS_COOKIE ?? &quot;vos_access&quot;;&#10;&#10;&#10;const MAP: Record&lt;&#10;    string,&#10;    { path: string; fields: string; nameField: string; idField: string; extra?: string[] }&#10;&gt; = {&#10;    units: {&#10;        path: &quot;units&quot;,&#10;        fields: &quot;unit_id,unit_name,unit_shortcut&quot;,&#10;        nameField: &quot;unit_name&quot;,&#10;        idField: &quot;unit_id&quot;,&#10;        extra: [&quot;unit_shortcut&quot;]&#10;    },&#10;    brand: {path: &quot;brand&quot;, fields: &quot;brand_id,brand_name&quot;, nameField: &quot;brand_name&quot;, idField: &quot;brand_id&quot;},&#10;    categories: {&#10;        path: &quot;categories&quot;,&#10;        fields: &quot;category_id,category_name&quot;,&#10;        nameField: &quot;category_name&quot;,&#10;        idField: &quot;category_id&quot;&#10;    },&#10;    segment: {path: &quot;segment&quot;, fields: &quot;segment_id,segment_name&quot;, nameField: &quot;segment_name&quot;, idField: &quot;segment_id&quot;},&#10;    sections: {path: &quot;sections&quot;, fields: &quot;section_id,section_name&quot;, nameField: &quot;section_name&quot;, idField: &quot;section_id&quot;},&#10;    branches: {&#10;        path: &quot;branches&quot;,&#10;        fields: &quot;branch_id,branch_name,branch_code&quot;,&#10;        nameField: &quot;branch_name&quot;,&#10;        idField: &quot;branch_id&quot;&#10;    },&#10;    company: {&#10;        path: &quot;company&quot;,&#10;        fields: &quot;company_id,company_name,company_code&quot;,&#10;        nameField: &quot;company_name&quot;,&#10;        idField: &quot;company_id&quot;&#10;    },&#10;    division: {&#10;        path: &quot;division&quot;,&#10;        fields: &quot;division_id,division_name&quot;,&#10;        nameField: &quot;division_name&quot;,&#10;        idField: &quot;division_id&quot;&#10;    },&#10;    suppliers: {&#10;        path: &quot;suppliers&quot;,&#10;        fields: &quot;id,supplier_name&quot;,&#10;        nameField: &quot;supplier_name&quot;,&#10;        idField: &quot;id&quot;&#10;    },&#10;    operation: {&#10;        path: &quot;operation&quot;,&#10;        fields: &quot;id,name,code&quot;,&#10;        nameField: &quot;name&quot;,&#10;        idField: &quot;id&quot;&#10;    },&#10;    price_types: {&#10;        path: &quot;price_types&quot;,&#10;        fields: &quot;price_type_id,price_type_name,code&quot;,&#10;        nameField: &quot;price_type_name&quot;,&#10;        idField: &quot;price_type_id&quot;&#10;    },&#10;    transaction_types: {&#10;        path: &quot;transaction_types&quot;,&#10;        fields: &quot;id,transaction_type&quot;,&#10;        nameField: &quot;transaction_type&quot;,&#10;        idField: &quot;id&quot;&#10;    }&#10;};&#10;&#10;export async function GET(req: NextRequest, context: { params: Promise&lt;{ resource: string }&gt; }) {&#10;    const { resource } = await context.params;&#10;    const cfg = MAP[resource];&#10;    if (!cfg) return NextResponse.json([], { status: 200 });&#10;&#10;    const url = new URL(req.url);&#10;    const q = url.searchParams.get(&quot;q&quot;) ?? &quot;&quot;;&#10;&#10;    const cookieStore = await nextCookies();&#10;    const auth = cookieStore.get(ACCESS)?.value;&#10;&#10;    const supabase = createClient(&#10;        process.env.NEXT_PUBLIC_SUPABASE_URL!,&#10;        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,&#10;        { global: { headers: { Authorization: `Bearer ${auth}` } } }&#10;    );&#10;&#10;    let query = supabase.from(cfg.path).select(cfg.fields).limit(20).order(cfg.nameField);&#10;&#10;    if (q.trim()) {&#10;        query = query.ilike(cfg.nameField, `%${q.trim()}%`);&#10;    }&#10;&#10;    const { data, error } = await query;&#10;&#10;    if (error || !data) {&#10;        console.error(error);&#10;        return NextResponse.json([], { status: 200 });&#10;    }&#10;&#10;    const options = (data as any[]).map((row) =&gt; {&#10;        const id = row[cfg.idField];&#10;        const name = row[cfg.nameField];&#10;        const meta: any = {};&#10;        if (cfg.extra?.includes(&quot;unit_shortcut&quot;) &amp;&amp; row.unit_shortcut) {&#10;            meta.subtitle = row.unit_shortcut;&#10;        }&#10;        return { id, name, meta };&#10;    });&#10;&#10;    return NextResponse.json(options);&#10;}&#10;" />
              <option name="updatedContent" value="// src/app/api/lookup/[resource]/route.ts&#13;&#10;export const runtime = &quot;nodejs&quot;;&#13;&#10;&#13;&#10;import { NextRequest, NextResponse } from &quot;next/server&quot;;&#13;&#10;import { cookies as nextCookies } from &quot;next/headers&quot;;&#13;&#10;import { createClient } from &quot;@supabase/supabase-js&quot;;&#13;&#10;&#13;&#10;const ACCESS = process.env.AUTH_ACCESS_COOKIE ?? &quot;vos_access&quot;;&#13;&#10;&#13;&#10;&#13;&#10;const MAP: Record&lt;&#13;&#10;    string,&#13;&#10;    { path: string; fields: string; nameField: string; idField: string; extra?: string[] }&#13;&#10;&gt; = {&#13;&#10;    units: {&#13;&#10;        path: &quot;units&quot;,&#13;&#10;        fields: &quot;unit_id,unit_name,unit_shortcut&quot;,&#13;&#10;        nameField: &quot;unit_name&quot;,&#13;&#10;        idField: &quot;unit_id&quot;,&#13;&#10;        extra: [&quot;unit_shortcut&quot;]&#13;&#10;    },&#13;&#10;    brand: {path: &quot;brand&quot;, fields: &quot;brand_id,brand_name&quot;, nameField: &quot;brand_name&quot;, idField: &quot;brand_id&quot;},&#13;&#10;    categories: {&#13;&#10;        path: &quot;categories&quot;,&#13;&#10;        fields: &quot;category_id,category_name&quot;,&#13;&#10;        nameField: &quot;category_name&quot;,&#13;&#10;        idField: &quot;category_id&quot;&#13;&#10;    },&#13;&#10;    segment: {path: &quot;segment&quot;, fields: &quot;segment_id,segment_name&quot;, nameField: &quot;segment_name&quot;, idField: &quot;segment_id&quot;},&#13;&#10;    sections: {path: &quot;sections&quot;, fields: &quot;section_id,section_name&quot;, nameField: &quot;section_name&quot;, idField: &quot;section_id&quot;},&#13;&#10;    branches: {&#13;&#10;        path: &quot;branches&quot;,&#13;&#10;        fields: &quot;branch_id,branch_name,branch_code&quot;,&#13;&#10;        nameField: &quot;branch_name&quot;,&#13;&#10;        idField: &quot;branch_id&quot;&#13;&#10;    },&#13;&#10;    company: {&#13;&#10;        path: &quot;company&quot;,&#13;&#10;        fields: &quot;company_id,company_name,company_code&quot;,&#13;&#10;        nameField: &quot;company_name&quot;,&#13;&#10;        idField: &quot;company_id&quot;&#13;&#10;    },&#13;&#10;    division: {&#13;&#10;        path: &quot;division&quot;,&#13;&#10;        fields: &quot;division_id,division_name&quot;,&#13;&#10;        nameField: &quot;division_name&quot;,&#13;&#10;        idField: &quot;division_id&quot;&#13;&#10;    },&#13;&#10;    suppliers: {&#13;&#10;        path: &quot;suppliers&quot;,&#13;&#10;        fields: &quot;id,supplier_name&quot;,&#13;&#10;        nameField: &quot;supplier_name&quot;,&#13;&#10;        idField: &quot;id&quot;&#13;&#10;    },&#13;&#10;    operation: {&#13;&#10;        path: &quot;operation&quot;,&#13;&#10;        fields: &quot;id,name,code&quot;,&#13;&#10;        nameField: &quot;name&quot;,&#13;&#10;        idField: &quot;id&quot;&#13;&#10;    },&#13;&#10;    price_types: {&#10;        path: &quot;price_types&quot;,&#10;        fields: &quot;price_type_id,price_type_name,code&quot;,&#10;        nameField: &quot;price_type_name&quot;,&#10;        idField: &quot;price_type_id&quot;&#10;    }&#10;    // transaction_types: {  // Table doesn't exist in Supabase&#10;    //     path: &quot;transaction_types&quot;,&#10;    //     fields: &quot;id,transaction_type&quot;,&#10;    //     nameField: &quot;transaction_type&quot;,&#10;    //     idField: &quot;id&quot;&#10;    // }&#10;};&#13;&#10;&#13;&#10;export async function GET(req: NextRequest, context: { params: Promise&lt;{ resource: string }&gt; }) {&#13;&#10;    const { resource } = await context.params;&#13;&#10;    const cfg = MAP[resource];&#13;&#10;    if (!cfg) return NextResponse.json([], { status: 200 });&#13;&#10;&#13;&#10;    const url = new URL(req.url);&#13;&#10;    const q = url.searchParams.get(&quot;q&quot;) ?? &quot;&quot;;&#13;&#10;&#13;&#10;    const cookieStore = await nextCookies();&#13;&#10;    const auth = cookieStore.get(ACCESS)?.value;&#13;&#10;&#13;&#10;    const supabase = createClient(&#13;&#10;        process.env.NEXT_PUBLIC_SUPABASE_URL!,&#13;&#10;        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,&#13;&#10;        { global: { headers: { Authorization: `Bearer ${auth}` } } }&#13;&#10;    );&#13;&#10;&#13;&#10;    let query = supabase.from(cfg.path).select(cfg.fields).limit(20).order(cfg.nameField);&#13;&#10;&#13;&#10;    if (q.trim()) {&#13;&#10;        query = query.ilike(cfg.nameField, `%${q.trim()}%`);&#13;&#10;    }&#13;&#10;&#13;&#10;    const { data, error } = await query;&#13;&#10;&#13;&#10;    if (error || !data) {&#13;&#10;        console.error(error);&#13;&#10;        return NextResponse.json([], { status: 200 });&#13;&#10;    }&#13;&#10;&#13;&#10;    const options = (data as any[]).map((row) =&gt; {&#13;&#10;        const id = row[cfg.idField];&#13;&#10;        const name = row[cfg.nameField];&#13;&#10;        const meta: any = {};&#13;&#10;        if (cfg.extra?.includes(&quot;unit_shortcut&quot;) &amp;&amp; row.unit_shortcut) {&#13;&#10;            meta.subtitle = row.unit_shortcut;&#13;&#10;        }&#13;&#10;        return { id, name, meta };&#13;&#10;    });&#13;&#10;&#13;&#10;    return NextResponse.json(options);&#13;&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/vos-erp/src/modules/supplier-management/components/SupplierFormDialog.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/vos-erp/src/modules/supplier-management/components/SupplierFormDialog.tsx" />
              <option name="originalContent" value="&quot;use client&quot;;&#10;&#10;import { useEffect, useMemo, useState } from &quot;react&quot;;&#10;import type { Supplier, UpsertSupplierDTO } from &quot;../types&quot;;&#10;import { supabase } from &quot;../../../lib/supabase&quot;;&#10;&#10;type Province = { province_code: string; province_name: string; region_code?: string; psgc_code?: string };&#10;type City = { city_code: string; city_name: string; province_code: string; region_desc?: string; psgc_code?: string };&#10;type Barangay = { brgy_code: string; brgy_name: string; city_code: string; province_code?: string; region_code?: string };&#10;type Country = { name: string };&#10;type DeliveryTerm = { id: number; delivery_name: string };&#10;type SupplierType = { id: number; transaction_type: string };&#10;&#10;&#10;function InputLabel({ children, required }: { children: any; required?: boolean }) {&#10;  return (&#10;    &lt;div className=&quot;text-sm font-medium mb-1&quot;&gt;&#10;      {children}&#10;      {required ? &lt;span className=&quot;text-red-500&quot;&gt; *&lt;/span&gt; : null}&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;&#10;export function SupplierFormDialog({&#10;  open,&#10;  mode,&#10;  initial,&#10;  onClose,&#10;  onSubmit,&#10;}: {&#10;  open: boolean;&#10;  mode: &quot;create&quot; | &quot;edit&quot;;&#10;  initial?: Partial&lt;Supplier&gt;;&#10;  onClose: () =&gt; void;&#10;  onSubmit: (dto: UpsertSupplierDTO) =&gt; Promise&lt;void&gt;;&#10;}) {&#10;  const [supplier_name, setSupplierName] = useState(initial?.supplier_name ?? &quot;&quot;);&#10;  const [supplier_shortcut, setSupplierShortcut] = useState(initial?.supplier_shortcut ?? &quot;&quot;);&#10;  const [contact_person, setContactPerson] = useState(initial?.contact_person ?? &quot;&quot;);&#10;  const [email_address, setEmailAddress] = useState(initial?.email_address ?? &quot;&quot;);&#10;  const [phone_number, setPhoneNumber] = useState(initial?.phone_number ?? &quot;&quot;);&#10;  const [address, setAddress] = useState(initial?.address ?? &quot;&quot;);&#10;  const [city, setCity] = useState(initial?.city ?? &quot;&quot;);&#10;  const [brgy, setBrgy] = useState(initial?.brgy ?? &quot;&quot;);&#10;  const [state_province, setStateProvince] = useState(initial?.state_province ?? &quot;&quot;);&#10;  const [postal_code, setPostalCode] = useState(initial?.postal_code ?? &quot;&quot;);&#10;  const [country, setCountry] = useState(initial?.country ?? &quot;Philippines&quot;);&#10;  const [supplier_type, setSupplierType] = useState&lt;string | null&gt;(initial?.supplier_type ?? null);&#10;  const [tin_number, setTinNumber] = useState(initial?.tin_number ?? &quot;&quot;);&#10;  const [bank_details, setBankDetails] = useState(initial?.bank_details ?? &quot;&quot;);&#10;  const [payment_terms, setPaymentTerms] = useState(initial?.payment_terms ?? &quot;Cash On Delivery&quot;);&#10;  const [delivery_terms, setDeliveryTerms] = useState&lt;number | null&gt;(null);&#10;  const [agreement_or_contract, setAgreementOrContract] = useState(initial?.agreement_or_contract ?? &quot;&quot;);&#10;  const [preferred_communication_method, setPreferredCommunicationMethod] = useState(initial?.preferred_communication_method ?? &quot;&quot;);&#10;  const [notes_or_comments, setNotesOrComments] = useState(initial?.notes_or_comments ?? &quot;&quot;);&#10;  const [isActive, setIsActive] = useState(initial?.isActive ?? 1);&#10;&#10;  const [submitting, setSubmitting] = useState(false);&#10;&#10;  // Codes used for filtering/cascading&#10;  const [provinceCode, setProvinceCode] = useState&lt;string&gt;(&quot;&quot;);&#10;  const [cityCode, setCityCode] = useState&lt;string&gt;(&quot;&quot;);&#10;&#10;  // Local geographic datasets&#10;  const [provinces, setProvinces] = useState&lt;Province[]&gt;([]);&#10;  const [cities, setCities] = useState&lt;City[]&gt;([]);&#10;  const [barangays, setBarangays] = useState&lt;Barangay[]&gt;([]);&#10;  const [countries, setCountries] = useState&lt;Country[]&gt;([]);&#10;  const [deliveryTermsOptions, setDeliveryTermsOptions] = useState&lt;DeliveryTerm[]&gt;([]);&#10;  const [supplierTypes, setSupplierTypes] = useState&lt;SupplierType[]&gt;([]);&#10;  const [loadingGeo, setLoadingGeo] = useState&lt;boolean&gt;(false);&#10;&#10;  // Derived filtered lists&#10;  const provinceOptions = useMemo(() =&gt; {&#10;    return [...provinces].sort((a, b) =&gt; a.province_name.localeCompare(b.province_name));&#10;  }, [provinces]);&#10;&#10;  const cityOptions = useMemo(() =&gt; {&#10;    const filtered = provinceCode ? cities.filter((c) =&gt; c.province_code === provinceCode) : cities;&#10;    return filtered.sort((a, b) =&gt; a.city_name.localeCompare(b.city_name));&#10;  }, [cities, provinceCode]);&#10;&#10;  const barangayOptions = useMemo(() =&gt; {&#10;    const filtered = cityCode ? barangays.filter((b) =&gt; b.city_code === cityCode) : [];&#10;    return filtered.sort((a, b) =&gt; a.brgy_name.localeCompare(b.brgy_name));&#10;  }, [barangays, cityCode]);&#10;&#10;  // Helper: find codes by names (case-insensitive)&#10;  function findProvinceCodeByName(name?: string | null): string {&#10;    if (!name) return &quot;&quot;;&#10;    const n = String(name).trim().toLowerCase();&#10;    return provinces.find((p) =&gt; p.province_name.trim().toLowerCase() === n)?.province_code || &quot;&quot;;&#10;  }&#10;  function findCityCodeByName(name?: string | null, provCode?: string): string {&#10;    if (!name) return &quot;&quot;;&#10;    const n = String(name).trim().toLowerCase();&#10;    const list = provCode ? cities.filter((c) =&gt; c.province_code === provCode) : cities;&#10;    return list.find((c) =&gt; c.city_name.trim().toLowerCase() === n)?.city_code || &quot;&quot;;&#10;  }&#10;&#10;  useEffect(() =&gt; {&#10;    if (!open) return;&#10;    setSupplierName(initial?.supplier_name ?? &quot;&quot;);&#10;    setSupplierShortcut(initial?.supplier_shortcut ?? &quot;&quot;);&#10;    setContactPerson(initial?.contact_person ?? &quot;&quot;);&#10;    setEmailAddress(initial?.email_address ?? &quot;&quot;);&#10;    setPhoneNumber(initial?.phone_number ?? &quot;&quot;);&#10;    setAddress(initial?.address ?? &quot;&quot;);&#10;    setCity(initial?.city ?? &quot;&quot;);&#10;    setBrgy(initial?.brgy ?? &quot;&quot;);&#10;    setStateProvince(initial?.state_province ?? &quot;&quot;);&#10;    setPostalCode(initial?.postal_code ?? &quot;&quot;);&#10;    setCountry(initial?.country ?? &quot;Philippines&quot;);&#10;    setSupplierType(initial?.supplier_type ?? null);&#10;    setTinNumber(initial?.tin_number ?? &quot;&quot;);&#10;    setBankDetails(initial?.bank_details ?? &quot;&quot;);&#10;    setPaymentTerms(initial?.payment_terms ?? &quot;Cash On Delivery&quot;);&#10;    setDeliveryTerms(typeof initial?.delivery_terms === 'number' ? initial.delivery_terms : null);&#10;    setAgreementOrContract(initial?.agreement_or_contract ?? &quot;&quot;);&#10;    setPreferredCommunicationMethod(initial?.preferred_communication_method ?? &quot;&quot;);&#10;    setNotesOrComments(initial?.notes_or_comments ?? &quot;&quot;);&#10;    setIsActive(initial?.isActive ?? 1);&#10;&#10;    // Lazy-load local geographic JSONs only when dialog is open&#10;    (async () =&gt; {&#10;      setLoadingGeo(true);&#10;      try {&#10;        // 1. Load local JSON files&#10;        const [&#10;          countriesMod,&#10;          provincesMod,&#10;          citiesMod,&#10;          barangaysMod,&#10;        ] = await Promise.all([&#10;          import(&quot;../../../../data/countries.json&quot;),&#10;          import(&quot;../../../../data/province.json&quot;),&#10;          import(&quot;../../../../data/city.json&quot;),&#10;          import(&quot;../../../../data/barangay.json&quot;),&#10;        ]);&#10;&#10;        // 2. Fetch dynamic data from Supabase&#10;        const { data: deliveryTermsData } = await supabase.from(&quot;delivery_terms&quot;).select(&quot;id, delivery_name&quot;);&#10;        const { data: transactionTypeData } = await supabase.from(&quot;transaction_types&quot;).select(&quot;id, transaction_type&quot;);&#10;&#10;        // 3. Process Local Data&#10;        const provArr: Province[] = (provincesMod as any).default ?? provincesMod;&#10;        const cityArr: City[] = (citiesMod as any).default ?? citiesMod;&#10;        const brgyArr: Barangay[] = (barangaysMod as any).default ?? barangaysMod;&#10;        const countryArr: Country[] = (countriesMod as any).default ?? countriesMod;&#10;&#10;        setCountries(countryArr);&#10;        setProvinces(provArr);&#10;        setCities(cityArr);&#10;        setBarangays(brgyArr);&#10;&#10;        // 4. Process Supabase Data&#10;        if (deliveryTermsData) {&#10;          setDeliveryTermsOptions(deliveryTermsData);&#10;          if (initial?.delivery_terms) {&#10;            // Validate that the initial value exists in the loaded options&#10;            const exists = deliveryTermsData.some((t) =&gt; t.id === initial.delivery_terms);&#10;            if (exists) setDeliveryTerms(initial.delivery_terms);&#10;          }&#10;        }&#10;&#10;        if (transactionTypeData) {&#10;          setSupplierTypes(transactionTypeData);&#10;        }&#10;&#10;        // 5. Derive codes from existing text (if editing)&#10;        const pCode = findProvinceCodeByName(initial?.state_province ?? &quot;&quot;);&#10;        setProvinceCode(pCode);&#10;&#10;        // We can try finding city code either globally or scoped to province if pCode exists&#10;        const cCode = findCityCodeByName(initial?.city ?? &quot;&quot;, pCode);&#10;        setCityCode(cCode);&#10;&#10;        // Ensure name matches code (sanity check for display)&#10;        if (cCode) {&#10;          const c = cityArr.find((x) =&gt; x.city_code === cCode);&#10;          if (c) setCity(c.city_name);&#10;        }&#10;&#10;      } catch (e) {&#10;        console.error(&quot;Failed to load form data&quot;, e);&#10;        // Fallback: keep empty lists if error&#10;      } finally {&#10;        setLoadingGeo(false);&#10;      }&#10;    })();&#10;  }, [open, initial]);&#10;&#10;  // When province code changes, clear dependent fields&#10;  useEffect(() =&gt; {&#10;    if (loadingGeo) return; // avoid clearing during initial bootstrap&#10;    setCityCode(&quot;&quot;);&#10;    setCity(&quot;&quot;);&#10;    setBrgy(&quot;&quot;);&#10;  }, [provinceCode, loadingGeo]);&#10;&#10;  // When city code changes, clear barangay text&#10;  useEffect(() =&gt; {&#10;    if (loadingGeo) return; // avoid clearing during initial bootstrap&#10;    setBrgy(&quot;&quot;);&#10;  }, [cityCode, loadingGeo]);&#10;&#10;  const canSubmit = useMemo(() =&gt; {&#10;    return supplier_name &amp;&amp; supplier_shortcut;&#10;  }, [supplier_name, supplier_shortcut]);&#10;&#10;  async function handleSubmit() {&#10;    if (!canSubmit) return;&#10;    try {&#10;      setSubmitting(true);&#10;      const today = new Date();&#10;      const year = today.getFullYear();&#10;      const month = String(today.getMonth() + 1).padStart(2, '0');&#10;      const day = String(today.getDate()).padStart(2, '0');&#10;      const formattedDate = `${year}-${month}-${day}`;&#10;&#10;      const dto: UpsertSupplierDTO = {&#10;        supplier_name,&#10;        supplier_shortcut,&#10;        contact_person,&#10;        email_address,&#10;        phone_number,&#10;        address,&#10;        city,&#10;        brgy,&#10;        state_province,&#10;        postal_code,&#10;        country,&#10;        supplier_type,&#10;        tin_number,&#10;        bank_details,&#10;        payment_terms,&#10;        delivery_terms,&#10;        agreement_or_contract,&#10;        preferred_communication_method,&#10;        notes_or_comments,&#10;        isActive,&#10;        date_added: mode === 'create' ? formattedDate : initial?.date_added,&#10;      };&#10;      await onSubmit(dto);&#10;      onClose();&#10;    } finally {&#10;      setSubmitting(false);&#10;    }&#10;  }&#10;&#10;  if (!open) return null;&#10;&#10;  return (&#10;    &lt;div className=&quot;fixed inset-0 z-50 flex items-center justify-center&quot;&gt;&#10;      &lt;div className=&quot;absolute inset-0 bg-black/30&quot; onClick={onClose} /&gt;&#10;      &lt;div className=&quot;relative w-full max-w-4xl rounded-xl bg-white shadow-xl border border-gray-200 p-5&quot;&gt;&#10;        &lt;h3 className=&quot;text-lg font-semibold mb-4&quot;&gt;&#10;          {mode === &quot;create&quot; ? &quot;Create New Supplier&quot; : &quot;Edit Supplier&quot;}&#10;        &lt;/h3&gt;&#10;&#10;        &lt;div className=&quot;grid grid-cols-1 md:grid-cols-3 gap-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel required&gt;Supplier Name&lt;/InputLabel&gt;&#10;            &lt;input value={supplier_name} onChange={(e) =&gt; setSupplierName(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel required&gt;Supplier Shortcut&lt;/InputLabel&gt;&#10;            &lt;input value={supplier_shortcut} onChange={(e) =&gt; setSupplierShortcut(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Contact Person&lt;/InputLabel&gt;&#10;            &lt;input value={contact_person} onChange={(e) =&gt; setContactPerson(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Email&lt;/InputLabel&gt;&#10;            &lt;input type=&quot;email&quot; value={email_address} onChange={(e) =&gt; setEmailAddress(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Phone Number&lt;/InputLabel&gt;&#10;            &lt;input value={phone_number} onChange={(e) =&gt; setPhoneNumber(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Address&lt;/InputLabel&gt;&#10;            &lt;input value={address} onChange={(e) =&gt; setAddress(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;State/Province&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={provinceCode}&#10;              onChange={(e) =&gt; {&#10;                const code = e.target.value;&#10;                setProvinceCode(code);&#10;                const p = provinceOptions.find((x) =&gt; x.province_code === code);&#10;                setStateProvince(p ? p.province_name : &quot;&quot;);&#10;              }}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;Select a Province&lt;/option&gt;&#10;              {provinceOptions.map((p, i) =&gt; (&#10;                &lt;option key={`${p.province_code}-${i}`} value={p.province_code}&gt;{p.province_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;City / Municipality&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={cityCode}&#10;              onChange={(e) =&gt; {&#10;                const code = e.target.value;&#10;                setCityCode(code);&#10;                const c = cityOptions.find((x) =&gt; x.city_code === code);&#10;                setCity(c ? c.city_name : &quot;&quot;);&#10;              }}&#10;              disabled={!provinceCode}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;{provinceCode ? &quot;Select a City / Municipality&quot; : &quot;Select province first&quot;}&lt;/option&gt;&#10;              {cityOptions.map((c, i) =&gt; (&#10;                &lt;option key={`${c.city_code}-${i}`} value={c.city_code}&gt;{c.city_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Barangay&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={brgy || &quot;&quot;}&#10;              onChange={(e) =&gt; {&#10;                const name = e.target.value;&#10;                setBrgy(name);&#10;              }}&#10;              disabled={!cityCode}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;{cityCode ? &quot;Select a Barangay&quot; : &quot;Select city first&quot;}&lt;/option&gt;&#10;              {barangayOptions.map((b, i) =&gt; (&#10;                &lt;option key={`${b.brgy_code}-${i}`} value={b.brgy_name}&gt;{b.brgy_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Postal Code&lt;/InputLabel&gt;&#10;            &lt;input value={postal_code} onChange={(e) =&gt; setPostalCode(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Country&lt;/InputLabel&gt;&#10;            &lt;select value={country} onChange={(e) =&gt; setCountry(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              {countries.map((c) =&gt; (&#10;                &lt;option key={c.name} value={c.name}&gt;{c.name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Supplier Type&lt;/InputLabel&gt;&#10;            &lt;select value={supplier_type ?? &quot;&quot;} onChange={(e) =&gt; setSupplierType(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              &lt;option value=&quot;&quot;&gt;-- Select Type --&lt;/option&gt;&#10;              {supplierTypes.map((t) =&gt; (&#10;                &lt;option key={t.id} value={t.transaction_type}&gt;&#10;                  {t.transaction_type}&#10;                &lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;col-span-2&quot;&gt;&#10;            &lt;InputLabel&gt;TIN #&lt;/InputLabel&gt;&#10;            &lt;input value={tin_number} onChange={(e) =&gt; setTinNumber(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;col-span-2&quot;&gt;&#10;            &lt;InputLabel&gt;Bank Details&lt;/InputLabel&gt;&#10;            &lt;input value={bank_details} onChange={(e) =&gt; setBankDetails(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Payment Terms&lt;/InputLabel&gt;&#10;            &lt;input value={payment_terms} onChange={(e) =&gt; setPaymentTerms(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Delivery Terms&lt;/InputLabel&gt;&#10;            &lt;select value={delivery_terms ?? &quot;&quot;} onChange={(e) =&gt; setDeliveryTerms(Number(e.target.value) || null)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              &lt;option value=&quot;&quot;&gt;Select Delivery Term&lt;/option&gt;&#10;              {deliveryTermsOptions.map((d) =&gt; (&#10;                &lt;option key={d.id} value={d.id}&gt;{d.delivery_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Agreement/Contract&lt;/InputLabel&gt;&#10;            &lt;input value={agreement_or_contract} onChange={(e) =&gt; setAgreementOrContract(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Preferred Communication&lt;/InputLabel&gt;&#10;            &lt;input value={preferred_communication_method} onChange={(e) =&gt; setPreferredCommunicationMethod(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;md:col-span-3&quot;&gt;&#10;            &lt;InputLabel&gt;Notes/Comments&lt;/InputLabel&gt;&#10;            &lt;textarea value={notes_or_comments} onChange={(e) =&gt; setNotesOrComments(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Is Active?&lt;/InputLabel&gt;&#10;            &lt;select value={isActive} onChange={(e) =&gt; setIsActive(Number(e.target.value))} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              &lt;option value={1}&gt;Yes&lt;/option&gt;&#10;              &lt;option value={0}&gt;No&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;mt-6 flex items-center justify-end gap-2&quot;&gt;&#10;          &lt;button className=&quot;px-3 py-2 rounded-lg border text-sm&quot; onClick={onClose} disabled={submitting}&gt;&#10;            Cancel&#10;          &lt;/button&gt;&#10;          &lt;button className=&quot;px-4 py-2 rounded-lg bg-black text-white text-sm disabled:opacity-50&quot; disabled={!canSubmit || submitting} onClick={handleSubmit}&gt;&#10;            {submitting ? &quot;Saving...&quot; : (mode === &quot;create&quot; ? &quot;Create Supplier&quot; : &quot;Save Changes&quot;)}&#10;          &lt;/button&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;&#10;import { useEffect, useMemo, useState } from &quot;react&quot;;&#10;import type { Supplier, UpsertSupplierDTO } from &quot;../types&quot;;&#10;import { supabase } from &quot;../../../lib/supabase&quot;;&#10;&#10;type Province = { province_code: string; province_name: string; region_code?: string; psgc_code?: string };&#10;type City = { city_code: string; city_name: string; province_code: string; region_desc?: string; psgc_code?: string };&#10;type Barangay = { brgy_code: string; brgy_name: string; city_code: string; province_code?: string; region_code?: string };&#10;type Country = { name: string };&#10;type DeliveryTerm = { id: number; delivery_name: string };&#10;type SupplierType = { id: number; transaction_type: string };&#10;&#10;&#10;function InputLabel({ children, required }: { children: any; required?: boolean }) {&#10;  return (&#10;    &lt;div className=&quot;text-sm font-medium mb-1&quot;&gt;&#10;      {children}&#10;      {required ? &lt;span className=&quot;text-red-500&quot;&gt; *&lt;/span&gt; : null}&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;&#10;export function SupplierFormDialog({&#10;  open,&#10;  mode,&#10;  initial,&#10;  onClose,&#10;  onSubmit,&#10;}: {&#10;  open: boolean;&#10;  mode: &quot;create&quot; | &quot;edit&quot;;&#10;  initial?: Partial&lt;Supplier&gt;;&#10;  onClose: () =&gt; void;&#10;  onSubmit: (dto: UpsertSupplierDTO) =&gt; Promise&lt;void&gt;;&#10;}) {&#10;  const [supplier_name, setSupplierName] = useState(initial?.supplier_name ?? &quot;&quot;);&#10;  const [supplier_shortcut, setSupplierShortcut] = useState(initial?.supplier_shortcut ?? &quot;&quot;);&#10;  const [contact_person, setContactPerson] = useState(initial?.contact_person ?? &quot;&quot;);&#10;  const [email_address, setEmailAddress] = useState(initial?.email_address ?? &quot;&quot;);&#10;  const [phone_number, setPhoneNumber] = useState(initial?.phone_number ?? &quot;&quot;);&#10;  const [address, setAddress] = useState(initial?.address ?? &quot;&quot;);&#10;  const [city, setCity] = useState(initial?.city ?? &quot;&quot;);&#10;  const [brgy, setBrgy] = useState(initial?.brgy ?? &quot;&quot;);&#10;  const [state_province, setStateProvince] = useState(initial?.state_province ?? &quot;&quot;);&#10;  const [postal_code, setPostalCode] = useState(initial?.postal_code ?? &quot;&quot;);&#10;  const [country, setCountry] = useState(initial?.country ?? &quot;Philippines&quot;);&#10;  const [supplier_type, setSupplierType] = useState&lt;string | null&gt;(initial?.supplier_type ?? null);&#10;  const [tin_number, setTinNumber] = useState(initial?.tin_number ?? &quot;&quot;);&#10;  const [bank_details, setBankDetails] = useState(initial?.bank_details ?? &quot;&quot;);&#10;  const [payment_terms, setPaymentTerms] = useState(initial?.payment_terms ?? &quot;Cash On Delivery&quot;);&#10;  const [delivery_terms, setDeliveryTerms] = useState&lt;number | null&gt;(null);&#10;  const [agreement_or_contract, setAgreementOrContract] = useState(initial?.agreement_or_contract ?? &quot;&quot;);&#10;  const [preferred_communication_method, setPreferredCommunicationMethod] = useState(initial?.preferred_communication_method ?? &quot;&quot;);&#10;  const [notes_or_comments, setNotesOrComments] = useState(initial?.notes_or_comments ?? &quot;&quot;);&#10;  const [isActive, setIsActive] = useState(initial?.isActive ?? 1);&#10;&#10;  const [submitting, setSubmitting] = useState(false);&#10;&#10;  // Codes used for filtering/cascading&#10;  const [provinceCode, setProvinceCode] = useState&lt;string&gt;(&quot;&quot;);&#10;  const [cityCode, setCityCode] = useState&lt;string&gt;(&quot;&quot;);&#10;&#10;  // Local geographic datasets&#10;  const [provinces, setProvinces] = useState&lt;Province[]&gt;([]);&#10;  const [cities, setCities] = useState&lt;City[]&gt;([]);&#10;  const [barangays, setBarangays] = useState&lt;Barangay[]&gt;([]);&#10;  const [countries, setCountries] = useState&lt;Country[]&gt;([]);&#10;  const [deliveryTermsOptions, setDeliveryTermsOptions] = useState&lt;DeliveryTerm[]&gt;([]);&#10;  const [supplierTypes, setSupplierTypes] = useState&lt;SupplierType[]&gt;([]);&#10;  const [loadingGeo, setLoadingGeo] = useState&lt;boolean&gt;(false);&#10;&#10;  // Derived filtered lists&#10;  const provinceOptions = useMemo(() =&gt; {&#10;    return [...provinces].sort((a, b) =&gt; a.province_name.localeCompare(b.province_name));&#10;  }, [provinces]);&#10;&#10;  const cityOptions = useMemo(() =&gt; {&#10;    const filtered = provinceCode ? cities.filter((c) =&gt; c.province_code === provinceCode) : cities;&#10;    return filtered.sort((a, b) =&gt; a.city_name.localeCompare(b.city_name));&#10;  }, [cities, provinceCode]);&#10;&#10;  const barangayOptions = useMemo(() =&gt; {&#10;    const filtered = cityCode ? barangays.filter((b) =&gt; b.city_code === cityCode) : [];&#10;    return filtered.sort((a, b) =&gt; a.brgy_name.localeCompare(b.brgy_name));&#10;  }, [barangays, cityCode]);&#10;&#10;  // Helper: find codes by names (case-insensitive)&#10;  function findProvinceCodeByName(name?: string | null): string {&#10;    if (!name) return &quot;&quot;;&#10;    const n = String(name).trim().toLowerCase();&#10;    return provinces.find((p) =&gt; p.province_name.trim().toLowerCase() === n)?.province_code || &quot;&quot;;&#10;  }&#10;  function findCityCodeByName(name?: string | null, provCode?: string): string {&#10;    if (!name) return &quot;&quot;;&#10;    const n = String(name).trim().toLowerCase();&#10;    const list = provCode ? cities.filter((c) =&gt; c.province_code === provCode) : cities;&#10;    return list.find((c) =&gt; c.city_name.trim().toLowerCase() === n)?.city_code || &quot;&quot;;&#10;  }&#10;&#10;  useEffect(() =&gt; {&#10;    if (!open) return;&#10;    setSupplierName(initial?.supplier_name ?? &quot;&quot;);&#10;    setSupplierShortcut(initial?.supplier_shortcut ?? &quot;&quot;);&#10;    setContactPerson(initial?.contact_person ?? &quot;&quot;);&#10;    setEmailAddress(initial?.email_address ?? &quot;&quot;);&#10;    setPhoneNumber(initial?.phone_number ?? &quot;&quot;);&#10;    setAddress(initial?.address ?? &quot;&quot;);&#10;    setCity(initial?.city ?? &quot;&quot;);&#10;    setBrgy(initial?.brgy ?? &quot;&quot;);&#10;    setStateProvince(initial?.state_province ?? &quot;&quot;);&#10;    setPostalCode(initial?.postal_code ?? &quot;&quot;);&#10;    setCountry(initial?.country ?? &quot;Philippines&quot;);&#10;    setSupplierType(initial?.supplier_type ?? null);&#10;    setTinNumber(initial?.tin_number ?? &quot;&quot;);&#10;    setBankDetails(initial?.bank_details ?? &quot;&quot;);&#10;    setPaymentTerms(initial?.payment_terms ?? &quot;Cash On Delivery&quot;);&#10;    setDeliveryTerms(typeof initial?.delivery_terms === 'number' ? initial.delivery_terms : null);&#10;    setAgreementOrContract(initial?.agreement_or_contract ?? &quot;&quot;);&#10;    setPreferredCommunicationMethod(initial?.preferred_communication_method ?? &quot;&quot;);&#10;    setNotesOrComments(initial?.notes_or_comments ?? &quot;&quot;);&#10;    setIsActive(initial?.isActive ?? 1);&#10;&#10;    // Lazy-load local geographic JSONs only when dialog is open&#10;    (async () =&gt; {&#10;      setLoadingGeo(true);&#10;      try {&#10;        // 1. Load local JSON files&#10;        const [&#10;          countriesMod,&#10;          provincesMod,&#10;          citiesMod,&#10;          barangaysMod,&#10;        ] = await Promise.all([&#10;          import(&quot;../../../../data/countries.json&quot;),&#10;          import(&quot;../../../../data/province.json&quot;),&#10;          import(&quot;../../../../data/city.json&quot;),&#10;          import(&quot;../../../../data/barangay.json&quot;),&#10;        ]);&#10;&#10;        // 2. Fetch dynamic data from Supabase&#10;        const { data: deliveryTermsData } = await supabase.from(&quot;delivery_terms&quot;).select(&quot;id, delivery_name&quot;);&#10;        // Note: transaction_types table does not exist - removed to prevent 404 errors&#10;&#10;        // 3. Process Local Data&#10;        const provArr: Province[] = (provincesMod as any).default ?? provincesMod;&#10;        const cityArr: City[] = (citiesMod as any).default ?? citiesMod;&#10;        const brgyArr: Barangay[] = (barangaysMod as any).default ?? barangaysMod;&#10;        const countryArr: Country[] = (countriesMod as any).default ?? countriesMod;&#10;&#10;        setCountries(countryArr);&#10;        setProvinces(provArr);&#10;        setCities(cityArr);&#10;        setBarangays(brgyArr);&#10;&#10;        // 4. Process Supabase Data&#10;        if (deliveryTermsData) {&#10;          setDeliveryTermsOptions(deliveryTermsData);&#10;          if (initial?.delivery_terms) {&#10;            // Validate that the initial value exists in the loaded options&#10;            const exists = deliveryTermsData.some((t) =&gt; t.id === initial.delivery_terms);&#10;            if (exists) setDeliveryTerms(initial.delivery_terms);&#10;          }&#10;        }&#10;&#10;        // Note: Supplier types/transaction types removed - table doesn't exist&#10;&#10;        // 5. Derive codes from existing text (if editing)&#10;        const pCode = findProvinceCodeByName(initial?.state_province ?? &quot;&quot;);&#10;        setProvinceCode(pCode);&#10;&#10;        // We can try finding city code either globally or scoped to province if pCode exists&#10;        const cCode = findCityCodeByName(initial?.city ?? &quot;&quot;, pCode);&#10;        setCityCode(cCode);&#10;&#10;        // Ensure name matches code (sanity check for display)&#10;        if (cCode) {&#10;          const c = cityArr.find((x) =&gt; x.city_code === cCode);&#10;          if (c) setCity(c.city_name);&#10;        }&#10;&#10;      } catch (e) {&#10;        console.error(&quot;Failed to load form data&quot;, e);&#10;        // Fallback: keep empty lists if error&#10;      } finally {&#10;        setLoadingGeo(false);&#10;      }&#10;    })();&#10;  }, [open, initial]);&#10;&#10;  // When province code changes, clear dependent fields&#10;  useEffect(() =&gt; {&#10;    if (loadingGeo) return; // avoid clearing during initial bootstrap&#10;    setCityCode(&quot;&quot;);&#10;    setCity(&quot;&quot;);&#10;    setBrgy(&quot;&quot;);&#10;  }, [provinceCode, loadingGeo]);&#10;&#10;  // When city code changes, clear barangay text&#10;  useEffect(() =&gt; {&#10;    if (loadingGeo) return; // avoid clearing during initial bootstrap&#10;    setBrgy(&quot;&quot;);&#10;  }, [cityCode, loadingGeo]);&#10;&#10;  const canSubmit = useMemo(() =&gt; {&#10;    return supplier_name &amp;&amp; supplier_shortcut;&#10;  }, [supplier_name, supplier_shortcut]);&#10;&#10;  async function handleSubmit() {&#10;    if (!canSubmit) return;&#10;    try {&#10;      setSubmitting(true);&#10;      const today = new Date();&#10;      const year = today.getFullYear();&#10;      const month = String(today.getMonth() + 1).padStart(2, '0');&#10;      const day = String(today.getDate()).padStart(2, '0');&#10;      const formattedDate = `${year}-${month}-${day}`;&#10;&#10;      const dto: UpsertSupplierDTO = {&#10;        supplier_name,&#10;        supplier_shortcut,&#10;        contact_person,&#10;        email_address,&#10;        phone_number,&#10;        address,&#10;        city,&#10;        brgy,&#10;        state_province,&#10;        postal_code,&#10;        country,&#10;        supplier_type,&#10;        tin_number,&#10;        bank_details,&#10;        payment_terms,&#10;        delivery_terms,&#10;        agreement_or_contract,&#10;        preferred_communication_method,&#10;        notes_or_comments,&#10;        isActive,&#10;        date_added: mode === 'create' ? formattedDate : initial?.date_added,&#10;      };&#10;      await onSubmit(dto);&#10;      onClose();&#10;    } finally {&#10;      setSubmitting(false);&#10;    }&#10;  }&#10;&#10;  if (!open) return null;&#10;&#10;  return (&#10;    &lt;div className=&quot;fixed inset-0 z-50 flex items-center justify-center&quot;&gt;&#10;      &lt;div className=&quot;absolute inset-0 bg-black/30&quot; onClick={onClose} /&gt;&#10;      &lt;div className=&quot;relative w-full max-w-4xl rounded-xl bg-white shadow-xl border border-gray-200 p-5&quot;&gt;&#10;        &lt;h3 className=&quot;text-lg font-semibold mb-4&quot;&gt;&#10;          {mode === &quot;create&quot; ? &quot;Create New Supplier&quot; : &quot;Edit Supplier&quot;}&#10;        &lt;/h3&gt;&#10;&#10;        &lt;div className=&quot;grid grid-cols-1 md:grid-cols-3 gap-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel required&gt;Supplier Name&lt;/InputLabel&gt;&#10;            &lt;input value={supplier_name} onChange={(e) =&gt; setSupplierName(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel required&gt;Supplier Shortcut&lt;/InputLabel&gt;&#10;            &lt;input value={supplier_shortcut} onChange={(e) =&gt; setSupplierShortcut(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Contact Person&lt;/InputLabel&gt;&#10;            &lt;input value={contact_person} onChange={(e) =&gt; setContactPerson(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Email&lt;/InputLabel&gt;&#10;            &lt;input type=&quot;email&quot; value={email_address} onChange={(e) =&gt; setEmailAddress(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Phone Number&lt;/InputLabel&gt;&#10;            &lt;input value={phone_number} onChange={(e) =&gt; setPhoneNumber(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Address&lt;/InputLabel&gt;&#10;            &lt;input value={address} onChange={(e) =&gt; setAddress(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;State/Province&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={provinceCode}&#10;              onChange={(e) =&gt; {&#10;                const code = e.target.value;&#10;                setProvinceCode(code);&#10;                const p = provinceOptions.find((x) =&gt; x.province_code === code);&#10;                setStateProvince(p ? p.province_name : &quot;&quot;);&#10;              }}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;Select a Province&lt;/option&gt;&#10;              {provinceOptions.map((p, i) =&gt; (&#10;                &lt;option key={`${p.province_code}-${i}`} value={p.province_code}&gt;{p.province_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;City / Municipality&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={cityCode}&#10;              onChange={(e) =&gt; {&#10;                const code = e.target.value;&#10;                setCityCode(code);&#10;                const c = cityOptions.find((x) =&gt; x.city_code === code);&#10;                setCity(c ? c.city_name : &quot;&quot;);&#10;              }}&#10;              disabled={!provinceCode}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;{provinceCode ? &quot;Select a City / Municipality&quot; : &quot;Select province first&quot;}&lt;/option&gt;&#10;              {cityOptions.map((c, i) =&gt; (&#10;                &lt;option key={`${c.city_code}-${i}`} value={c.city_code}&gt;{c.city_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Barangay&lt;/InputLabel&gt;&#10;            &lt;select&#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2&quot;&#10;              value={brgy || &quot;&quot;}&#10;              onChange={(e) =&gt; {&#10;                const name = e.target.value;&#10;                setBrgy(name);&#10;              }}&#10;              disabled={!cityCode}&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;{cityCode ? &quot;Select a Barangay&quot; : &quot;Select city first&quot;}&lt;/option&gt;&#10;              {barangayOptions.map((b, i) =&gt; (&#10;                &lt;option key={`${b.brgy_code}-${i}`} value={b.brgy_name}&gt;{b.brgy_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Postal Code&lt;/InputLabel&gt;&#10;            &lt;input value={postal_code} onChange={(e) =&gt; setPostalCode(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Country&lt;/InputLabel&gt;&#10;            &lt;select value={country} onChange={(e) =&gt; setCountry(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              {countries.map((c) =&gt; (&#10;                &lt;option key={c.name} value={c.name}&gt;{c.name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Supplier Type&lt;/InputLabel&gt;&#10;            &lt;select &#10;              value={supplier_type ?? &quot;&quot;} &#10;              onChange={(e) =&gt; setSupplierType(e.target.value)} &#10;              className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-gray-50&quot; &#10;              disabled&#10;              title=&quot;Supplier types table not configured in database&quot;&#10;            &gt;&#10;              &lt;option value=&quot;&quot;&gt;-- Not Available --&lt;/option&gt;&#10;            &lt;/select&gt;&#10;            &lt;div className=&quot;text-xs text-gray-400 mt-1&quot;&gt;Table not configured&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;col-span-2&quot;&gt;&#10;            &lt;InputLabel&gt;TIN #&lt;/InputLabel&gt;&#10;            &lt;input value={tin_number} onChange={(e) =&gt; setTinNumber(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;col-span-2&quot;&gt;&#10;            &lt;InputLabel&gt;Bank Details&lt;/InputLabel&gt;&#10;            &lt;input value={bank_details} onChange={(e) =&gt; setBankDetails(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Payment Terms&lt;/InputLabel&gt;&#10;            &lt;input value={payment_terms} onChange={(e) =&gt; setPaymentTerms(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Delivery Terms&lt;/InputLabel&gt;&#10;            &lt;select value={delivery_terms ?? &quot;&quot;} onChange={(e) =&gt; setDeliveryTerms(Number(e.target.value) || null)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              &lt;option value=&quot;&quot;&gt;Select Delivery Term&lt;/option&gt;&#10;              {deliveryTermsOptions.map((d) =&gt; (&#10;                &lt;option key={d.id} value={d.id}&gt;{d.delivery_name}&lt;/option&gt;&#10;              ))}&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Agreement/Contract&lt;/InputLabel&gt;&#10;            &lt;input value={agreement_or_contract} onChange={(e) =&gt; setAgreementOrContract(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Preferred Communication&lt;/InputLabel&gt;&#10;            &lt;input value={preferred_communication_method} onChange={(e) =&gt; setPreferredCommunicationMethod(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div className=&quot;md:col-span-3&quot;&gt;&#10;            &lt;InputLabel&gt;Notes/Comments&lt;/InputLabel&gt;&#10;            &lt;textarea value={notes_or_comments} onChange={(e) =&gt; setNotesOrComments(e.target.value)} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm&quot; /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;InputLabel&gt;Is Active?&lt;/InputLabel&gt;&#10;            &lt;select value={isActive} onChange={(e) =&gt; setIsActive(Number(e.target.value))} className=&quot;w-full rounded-lg border border-gray-200 px-3 py-2 text-sm bg-white&quot;&gt;&#10;              &lt;option value={1}&gt;Yes&lt;/option&gt;&#10;              &lt;option value={0}&gt;No&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;mt-6 flex items-center justify-end gap-2&quot;&gt;&#10;          &lt;button className=&quot;px-3 py-2 rounded-lg border text-sm&quot; onClick={onClose} disabled={submitting}&gt;&#10;            Cancel&#10;          &lt;/button&gt;&#10;          &lt;button className=&quot;px-4 py-2 rounded-lg bg-black text-white text-sm disabled:opacity-50&quot; disabled={!canSubmit || submitting} onClick={handleSubmit}&gt;&#10;            {submitting ? &quot;Saving...&quot; : (mode === &quot;create&quot; ? &quot;Create Supplier&quot; : &quot;Save Changes&quot;)}&#10;          &lt;/button&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>