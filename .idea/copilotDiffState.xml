<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/vos-erp/src/modules/sales-order-management/SalesOrderManagementModule.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/vos-erp/src/modules/sales-order-management/SalesOrderManagementModule.tsx" />
              <option name="originalContent" value="// src/modules/customer-management/components/SalesOrderManagementModule.tsx&#10;&quot;use client&quot;;&#10;&#10;import React, { useState, ChangeEvent, FormEvent, useEffect } from 'react';&#10;import { Input } from '@/components/ui/input';&#10;import { Button } from '@/components/ui/button';&#10;import { Label } from &quot;@/components/ui/label&quot;;&#10;import axios from 'axios';&#10;import AsyncSelect from 'react-select/async';&#10;&#10;// --- Static Data Imports ---&#10;import provincesData from &quot;@/public/province.json&quot;;&#10;import citiesData from &quot;@/public/city.json&quot;;&#10;import barangaysData from &quot;@/public/barangay.json&quot;;&#10;&#10;// --- Type Definitions ---&#10;&#10;// ✅ FIX: This interface now matches what your form state (clientInfo) actually uses.&#10;interface ClientInfo {&#10;    id?: number;&#10;    complete_name: string; // Changed from first_name/last_name&#10;    email: string;&#10;    phone: string;&#10;    street_address: string;&#10;    province_state: string; // This will hold the province_code&#10;    city_municipality: string; // This will hold the city_code&#10;    barangay: string; // This will hold the brgy_code&#10;}&#10;&#10;interface RoomData {&#10;    property_type_id: number | '';&#10;    room_use_id: number | '';&#10;    length_m: number | '';&#10;    width_m: number | '';&#10;    ceiling_height_m: number | '';&#10;    sun_exposure_id: number | '';&#10;    insulation_type_id: number | '';&#10;    typical_occupants: number | '';&#10;    windows: { width_m: number | ''; height_m: number | '' }[];&#10;}&#10;&#10;interface RequestData {&#10;    supply_voltage_id: number | '';&#10;    available_breaker_amps: number | '';&#10;    preferred_unit_type_id: number | '';&#10;    budget_php: number | '';&#10;    notes: string;&#10;    preferred_date: string;&#10;    preferred_time: string;&#10;}&#10;&#10;interface DropdownOption { id: number; name: string; }&#10;&#10;// ✅ FIX: Define the shape of the customer API data&#10;interface ApiCustomer {&#10;    id: number;&#10;    customer_name: string;&#10;    customer_email: string;&#10;    contact_number: string;&#10;    street_address: string | null;&#10;    province: string;&#10;    city: string;&#10;    brgy: string;&#10;    [key: string]: any; // Allow other properties&#10;}&#10;&#10;// ✅ FIX: The 'value' is now the full ApiCustomer object&#10;interface UserOption { label: string; value: ApiCustomer; }&#10;&#10;interface Province { province_code: string; province_name: string; }&#10;interface City { city_code: string; city_name: string; province_code: string; }&#10;interface Barangay { brgy_code: string; brgy_name: string; city_code: string; }&#10;&#10;// --- Main Component ---&#10;export default function SalesOrderManagementModule() {&#10;    // --- State Management ---&#10;    // ✅ FIX: Updated initial state to match the new ClientInfo interface&#10;    const [clientInfo, setClientInfo] = useState&lt;ClientInfo&gt;({&#10;        complete_name: '', email: '', phone: '',&#10;        street_address: '', province_state: '', city_municipality: '', barangay: ''&#10;    });&#10;    const [roomData, setRoomData] = useState&lt;RoomData&gt;({&#10;        property_type_id: '', room_use_id: '', length_m: '', width_m: '', ceiling_height_m: 2.4,&#10;        sun_exposure_id: '', insulation_type_id: '', typical_occupants: 1,&#10;        windows: [{ width_m: '', height_m: '' }],&#10;    });&#10;    const [requestData, setRequestData] = useState&lt;RequestData&gt;({&#10;        supply_voltage_id: '', available_breaker_amps: '', preferred_unit_type_id: '',&#10;        budget_php: '', notes: '', preferred_date: '', preferred_time: '',&#10;    });&#10;&#10;    const [selectedUser, setSelectedUser] = useState&lt;UserOption | null&gt;(null);&#10;    const [attachments, setAttachments] = useState&lt;File[]&gt;([]);&#10;    const [isSubmitting, setIsSubmitting] = useState(false);&#10;&#10;    // Dropdown options from API&#10;    const [propertyTypes, setPropertyTypes] = useState&lt;DropdownOption[]&gt;([]);&#10;    const [roomUses, setRoomUses] = useState&lt;DropdownOption[]&gt;([]);&#10;    const [sunExposures, setSunExposures] = useState&lt;DropdownOption[]&gt;([]);&#10;    const [insulationTypes, setInsulationTypes] = useState&lt;DropdownOption[]&gt;([]);&#10;    const [supplyVoltages, setSupplyVoltages] = useState&lt;DropdownOption[]&gt;([]);&#10;    const [acUnitTypes, setAcUnitTypes] = useState&lt;DropdownOption[]&gt;([]);&#10;&#10;    // Calculated values&#10;    const [roomVolume, setRoomVolume] = useState(0);&#10;    const [coolingCapacity, setCoolingCapacity] = useState(0);&#10;&#10;    // Filtered address options&#10;    const [filteredCities, setFilteredCities] = useState&lt;City[]&gt;([]);&#10;    const [filteredBarangays, setFilteredBarangays] = useState&lt;Barangay[]&gt;([]);&#10;&#10;    // --- Effect Hooks ---&#10;&#10;    useEffect(() =&gt; {&#10;        const length = Number(roomData.length_m) || 0;&#10;        const width = Number(roomData.width_m) || 0;&#10;        const height = Number(roomData.ceiling_height_m) || 0;&#10;        setRoomVolume(length * width * height);&#10;        // Using a common estimation formula: (L * W * AreaFactor) / 12000 BTU/hr per Ton. Here using a simplified HP calc.&#10;        setCoolingCapacity((length * width * 600) / 9000);&#10;    }, [roomData.length_m, roomData.width_m, roomData.ceiling_height_m]);&#10;&#10;    useEffect(() =&gt; {&#10;        const fetchDropdownData = async () =&gt; {&#10;            try {&#10;                const [&#10;                    roomUseRes, propTypeRes, sunExpRes, insulationRes, voltageRes, unitTypeRes&#10;                ] = await Promise.all([&#10;                    axios.get(&quot;/api/lookup/room_uses&quot;),&#10;                    axios.get(&quot;/api/lookup/property_types&quot;),&#10;                    axios.get(&quot;/api/lookup/sun_exposures&quot;),&#10;                    axios.get(&quot;/api/lookup/insulation_types&quot;),&#10;                    axios.get(&quot;/api/lookup/supply_voltages&quot;),&#10;                    axios.get(&quot;/api/lookup/ac_unit_types&quot;)&#10;                ]);&#10;&#10;                setRoomUses(roomUseRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.name })));&#10;                setPropertyTypes(propTypeRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.name })));&#10;                setSunExposures(sunExpRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.level })));&#10;                setInsulationTypes(insulationRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.type })));&#10;                setSupplyVoltages(voltageRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.voltage_range })));&#10;                setAcUnitTypes(unitTypeRes.data.data.map((item: any) =&gt; ({ id: item.id, name: item.type })));&#10;            } catch (error) {&#10;                console.error(&quot;Failed to fetch dropdown data:&quot;, error);&#10;                alert(&quot;Could not load form options. Please check the connection and refresh.&quot;);&#10;            }&#10;        };&#10;        fetchDropdownData();&#10;    }, []);&#10;&#10;    // --- Event Handlers ---&#10;&#10;    // ✅ FIX: This function now correctly types the response and returns the full 'user' object as the value.&#10;    const loadUserOptions = async (inputValue: string): Promise&lt;UserOption[]&gt; =&gt; {&#10;        if (inputValue.length &lt; 2) return [];&#10;        try {&#10;            // Updated to use new customer API and fields&#10;            const response = await axios.get(`/api/lookup/customer?search=${inputValue}`);&#10;            const users = response.data.data || [];&#10;            return users.map((user: ApiCustomer) =&gt; ({&#10;                label: `${user.customer_name} (${user.customer_email})`,&#10;                value: user // The value is the full customer object&#10;            }));&#10;        } catch (error) {&#10;            console.error(&quot;Failed to fetch users&quot;, error);&#10;            return [];&#10;        }&#10;    };&#10;&#10;    // ✅ FIX: This function is entirely replaced.&#10;    // It no longer makes a new API call.&#10;    // It uses the data from 'selectedOption.value' to populate all fields and dropdowns.&#10;    const handleUserSelect = (selectedOption: UserOption | null) =&gt; {&#10;        setSelectedUser(selectedOption);&#10;        if (!selectedOption) {&#10;            clearForm();&#10;            return;&#10;        }&#10;&#10;        // No fetch needed! Data is already here.&#10;        const clientData = selectedOption.value; // clientData is the full ApiCustomer object&#10;&#10;        // --- Find Codes from Names ---&#10;        const allProvinces = provincesData as Province[];&#10;        const allCities = citiesData as City[];&#10;        const allBarangays = barangaysData as Barangay[];&#10;&#10;        // 1. Find Province Code from Name&#10;        const provinceCode = allProvinces.find(p =&gt; p.province_name.toLowerCase() === clientData.province?.toLowerCase())?.province_code || &quot;&quot;;&#10;&#10;        // 2. Filter Cities based on Province Code&#10;        const citiesForProvince = provinceCode ? allCities.filter(c =&gt; c.province_code === provinceCode) : [];&#10;        setFilteredCities(citiesForProvince); // Update dropdown state&#10;&#10;        // 3. Find City Code from Name&#10;        const cityCode = citiesForProvince.find(c =&gt; c.city_name.toLowerCase() === clientData.city?.toLowerCase())?.city_code || &quot;&quot;;&#10;&#10;        // 4. Filter Barangays based on City Code&#10;        const barangaysForCity = cityCode ? allBarangays.filter(b =&gt; b.city_code === cityCode) : [];&#10;        setFilteredBarangays(barangaysForCity); // Update dropdown state&#10;&#10;        // 5. Find Barangay Code from Name&#10;        const barangayCode = barangaysForCity.find(b =&gt; b.brgy_name.toLowerCase() === clientData.brgy?.toLowerCase())?.brgy_code || &quot;&quot;;&#10;&#10;        // --- Set Full Client State ---&#10;        setClientInfo({&#10;            id: clientData.id, // Store the ID for updates&#10;            complete_name: clientData.customer_name || &quot;&quot;,&#10;            email: clientData.customer_email || &quot;&quot;,&#10;            phone: clientData.contact_number || &quot;&quot;,&#10;            street_address: clientData.street_address || &quot;&quot;, // Handle null&#10;            province_state: provinceCode, // Set the code&#10;            city_municipality: cityCode, // Set the code&#10;            barangay: barangayCode, // Set the code&#10;        });&#10;    };&#10;&#10;    const clearForm = () =&gt; {&#10;        // ✅ FIX: Matches the new ClientInfo state&#10;        setClientInfo({ complete_name: '', email: '', phone: '', street_address: '', province_state: '', city_municipality: '', barangay: '' });&#10;        setRoomData({ property_type_id: '', room_use_id: '', length_m: '', width_m: '', ceiling_height_m: 2.4, sun_exposure_id: '', insulation_type_id: '', typical_occupants: 1, windows: [{ width_m: '', height_m: '' }]});&#10;        setRequestData({ supply_voltage_id: '', available_breaker_amps: '', preferred_unit_type_id: '', budget_php: '', notes: '', preferred_date: '', preferred_time: '' });&#10;        setSelectedUser(null);&#10;        setAttachments([]);&#10;        setFilteredCities([]);&#10;        setFilteredBarangays([]);&#10;    };&#10;&#10;    const handleProvinceChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; {&#10;        const provinceCode = e.target.value;&#10;        setClientInfo(prev =&gt; ({ ...prev, province_state: provinceCode, city_municipality: &quot;&quot;, barangay: &quot;&quot; }));&#10;        setFilteredCities((citiesData as City[]).filter(city =&gt; city.province_code === provinceCode));&#10;        setFilteredBarangays([]);&#10;    };&#10;&#10;    const handleCityChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; {&#10;        const cityCode = e.target.value;&#10;        setClientInfo(prev =&gt; ({ ...prev, city_municipality: cityCode, barangay: &quot;&quot; }));&#10;        setFilteredBarangays((barangaysData as Barangay[]).filter(barangay =&gt; barangay.city_code === cityCode));&#10;    };&#10;&#10;    const handleClientInputChange = (e: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; setClientInfo(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#10;    const handleClientSelectChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; setClientInfo(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#10;    const handleRoomChange = (e: ChangeEvent&lt;HTMLInputElement | HTMLSelectElement&gt;) =&gt; setRoomData(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#10;    const handleRequestChange = (e: ChangeEvent&lt;HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement&gt;) =&gt; setRequestData(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#10;    const handleWindowChange = (index: number, e: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {&#10;        const { name, value } = e.target;&#10;        const updatedWindows = roomData.windows.map((win, i) =&gt; i === index ? { ...win, [name]: value === '' ? '' : parseFloat(value) } : win);&#10;        setRoomData(prev =&gt; ({ ...prev, windows: updatedWindows }));&#10;    };&#10;    const addWindow = () =&gt; setRoomData(prev =&gt; ({ ...prev, windows: [...prev.windows, { width_m: '', height_m: '' }] }));&#10;    const removeWindow = (index: number) =&gt; { if (roomData.windows.length &gt; 1) setRoomData(prev =&gt; ({ ...prev, windows: prev.windows.filter((_, i) =&gt; i !== index)})); };&#10;    const handleAttachmentChange = (event: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; { if (event.target.files) setAttachments(Array.from(event.target.files)); };&#10;&#10;    // --- Form Submission Logic ---&#10;    const handleSubmit = async (e: FormEvent) =&gt; {&#10;        e.preventDefault();&#10;        setIsSubmitting(true);&#10;&#10;        // --- Find full string names for address parts for the payload ---&#10;        const provinceName = (provincesData as Province[]).find(p =&gt; p.province_code === clientInfo.province_state)?.province_name || '';&#10;        const cityName = (citiesData as City[]).find(c =&gt; c.city_code === clientInfo.city_municipality)?.city_name || '';&#10;        const barangayName = (barangaysData as Barangay[]).find(b =&gt; b.brgy_code === clientInfo.barangay)?.brgy_name || '';&#10;&#10;        if (!provinceName || !cityName || !barangayName) {&#10;            alert(&quot;Please ensure a valid Province, City, and Barangay are selected.&quot;);&#10;            setIsSubmitting(false);&#10;            return;&#10;        }&#10;&#10;        try {&#10;            // --- STEP 1: Create or Update Customer ---&#10;            let customerId: number;&#10;            const customerPayload = {&#10;                customer_name: clientInfo.complete_name,&#10;                contact_number: clientInfo.phone,&#10;                customer_email: clientInfo.email,&#10;                street_address: clientInfo.street_address,&#10;                province: provinceName,&#10;                city: cityName,&#10;                brgy: barangayName,&#10;            };&#10;&#10;            if (clientInfo.id) {&#10;                // UPDATE existing customer&#10;                const response = await axios.patch(`/api/customer/${clientInfo.id}`, customerPayload);&#10;                customerId = response.data.data.id;&#10;            } else {&#10;                // CREATE new customer&#10;                const response = await axios.post(&quot;/api/customer&quot;, customerPayload);&#10;                customerId = response.data.data.id;&#10;            }&#10;&#10;            if (!customerId) throw new Error(&quot;Could not save customer information.&quot;);&#10;&#10;            console.log(&quot;Customer ID:&quot;, customerId); // Log the customer ID for debugging&#10;&#10;            // --- STEP 2: Create Installation Request ---&#10;            // Fetch existing installation requests to determine the next ir_code&#10;            const existingRequestsResponse = await axios.get(&quot;/api/installation_requests?fields=ir_code&quot;);&#10;            const existingRequests = existingRequestsResponse.data.data || [];&#10;&#10;            // Determine the highest ir_code and generate the next one&#10;            const highestIrCode = existingRequests&#10;                .map((req: { ir_code: string }) =&gt; parseInt(req.ir_code?.split('-')[1] || '0', 10))&#10;                .filter((num: number) =&gt; !isNaN(num)) // Fix: Add explicit type to num in filter&#10;                .reduce((max: number, num: number) =&gt; Math.max(max, num), 0); // Fix: Add explicit type to max and num in reduce&#10;&#10;            const nextIrCode = `SO-${(highestIrCode + 1).toString().padStart(4, '0')}`;&#10;&#10;            // Add the generated ir_code to the payload&#10;            const installationRequestPayload = {&#10;                client_id: customerId,&#10;                supply_voltage_id: requestData.supply_voltage_id || null,&#10;                available_breaker_amps: requestData.available_breaker_amps || null,&#10;                preferred_unit_type_id: requestData.preferred_unit_type_id || null,&#10;                budget_php: requestData.budget_php || null,&#10;                notes: requestData.notes,&#10;                preferred_date: requestData.preferred_date || null,&#10;                preferred_time: requestData.preferred_time || null,&#10;                room_data: {&#10;                    ...roomData,&#10;                    windows: roomData.windows.filter(w =&gt; w.width_m &amp;&amp; w.height_m) // Clean up empty windows&#10;                },&#10;                ir_code: nextIrCode // Include the generated ir_code&#10;            };&#10;&#10;            console.log(&quot;Generated ir_code:&quot;, nextIrCode); // Log the generated ir_code for debugging&#10;            console.log(&quot;Installation Request Payload:&quot;, installationRequestPayload); // Log the payload for debugging&#10;&#10;            const requestResponse = await axios.post(&quot;/api/installation_requests&quot;, installationRequestPayload);&#10;            const newRequestId = requestResponse.data.data.id;&#10;            console.log(&quot;Created installation request:&quot;, requestResponse.data.data);&#10;&#10;            if (!newRequestId) throw new Error(&quot;Could not create the installation request.&quot;);&#10;&#10;            // --- STEP 3 &amp; 4: Upload and Link Attachments ---&#10;            if (attachments.length &gt; 0) {&#10;                const uploadPromises = attachments.map(file =&gt; {&#10;                    const formData = new FormData();&#10;                    formData.append('file', file);&#10;                    return axios.post(&quot;/api/files&quot;, formData, {&#10;                        headers: { 'Content-Type': 'multipart/form-data' }&#10;                    });&#10;                });&#10;&#10;                const uploadResults = await Promise.all(uploadPromises);&#10;                console.log(&quot;File upload successful:&quot;, uploadResults);&#10;&#10;                const attachmentPayloads = uploadResults.map((result, index) =&gt; {&#10;                    const uploadedFile = result.data.data;&#10;                    const originalFile = attachments[index];&#10;                    return {&#10;                        request_id: newRequestId,&#10;                        file_name: originalFile.name,&#10;                        file_path: uploadedFile.id,&#10;                        file_type: originalFile.type,&#10;                        file_size_bytes: originalFile.size,&#10;                    };&#10;                });&#10;&#10;                await axios.post(&quot;/api/attachments&quot;, attachmentPayloads);&#10;                console.log(&quot;Attachment records created.&quot;);&#10;            }&#10;&#10;            // --- SUCCESS ---&#10;            alert(&quot;Request submitted successfully!&quot;);&#10;            clearForm();&#10;&#10;        } catch (error: any) {&#10;            console.error(&quot;Submission failed:&quot;, error);&#10;            const errorMessage = axios.isAxiosError(error)&#10;                ? error.response?.data?.errors?.[0]?.message || error.message&#10;                : error.message;&#10;            alert(`An error occurred: ${errorMessage}`);&#10;        } finally {&#10;            setIsSubmitting(false);&#10;        }&#10;    };&#10;&#10;    // --- JSX Return ---&#10;    return (&#10;        &lt;form className=&quot;space-y-6 p-6 bg-white rounded shadow-lg&quot; onSubmit={handleSubmit}&gt;&#10;&#10;            &lt;div className=&quot;space-y-2 p-4 border rounded bg-slate-50&quot;&gt;&#10;                &lt;Label htmlFor=&quot;clientSearch&quot; className=&quot;font-semibold&quot;&gt;Search Existing Client&lt;/Label&gt;&#10;                &lt;AsyncSelect id=&quot;clientSearch&quot; cacheOptions defaultOptions loadOptions={loadUserOptions} onChange={handleUserSelect} value={selectedUser} placeholder=&quot;Type a name or email to search...&quot; isClearable instanceId=&quot;clientSearch&quot; /&gt;&#10;                &lt;Button type=&quot;button&quot; onClick={clearForm} variant=&quot;outline&quot; className=&quot;mt-2&quot;&gt;Clear Form / New Client&lt;/Button&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;1) Client Information&lt;/h2&gt;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                    {/* ✅ FIX: Field name is 'complete_name' */}&#10;                    &lt;Label&gt;Complete Name *&lt;Input name=&quot;complete_name&quot; value={clientInfo.complete_name || ''} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Email&lt;Input name=&quot;email&quot; value={clientInfo.email} onChange={handleClientInputChange} type=&quot;email&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Phone *&lt;Input name=&quot;phone&quot; value={clientInfo.phone} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#10;                &lt;/div&gt;&#10;            &lt;/section&gt;&#10;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;2) Installation Address&lt;/h2&gt;&#10;                &lt;Label className=&quot;block w-full mb-2&quot;&gt;Street Address *&lt;Input name=&quot;street_address&quot; value={clientInfo.street_address} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-2&quot;&gt;&#10;                    &lt;Label&gt;Province *&#10;                        &lt;select name=&quot;province_state&quot; value={clientInfo.province_state} onChange={handleProvinceChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#10;                            &lt;option value=&quot;&quot;&gt;Select Province&lt;/option&gt;{(provincesData as Province[]).map((p, index) =&gt; (&lt;option key={`${p.province_code}-${index}`} value={p.province_code}&gt;{p.province_name}&lt;/option&gt;))}&lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;City/Municipality *&#10;                        &lt;select name=&quot;city_municipality&quot; value={clientInfo.city_municipality} onChange={handleCityChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required disabled={!clientInfo.province_state}&gt;&#10;                            &lt;option value=&quot;&quot;&gt;Select City/Municipality&lt;/option&gt;&#10;                            {filteredCities.map(c =&gt; &lt;option key={c.city_code} value={c.city_code}&gt;{c.city_name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Barangay *&#10;                        &lt;select name=&quot;barangay&quot; value={clientInfo.barangay} onChange={handleClientSelectChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required disabled={!clientInfo.city_municipality}&gt;&#10;                            &lt;option value=&quot;&quot;&gt;Select Barangay&lt;/option&gt;&#10;                            {filteredBarangays.map(b =&gt; &lt;option key={b.brgy_code} value={b.brgy_code}&gt;{b.brgy_name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                &lt;/div&gt;&#10;            &lt;/section&gt;&#10;&#10;            {/* ... (Rest of your component remains unchanged) ... */}&#10;&#10;            &lt;section className=&quot;border rounded p-4 space-y-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;3) Property &amp; Room Details&lt;/h2&gt;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                    &lt;Label&gt;Property Type *&#10;                        &lt;select name=&quot;property_type_id&quot; value={roomData.property_type_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Property Type&lt;/option&gt;&#10;                            {propertyTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Room Use *&#10;                        &lt;select name=&quot;room_use_id&quot; value={roomData.room_use_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Room Use&lt;/option&gt;&#10;                            {roomUses.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Room Length (m) *&lt;Input name=&quot;length_m&quot; value={roomData.length_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Room Width (m) *&lt;Input name=&quot;width_m&quot; value={roomData.width_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Ceiling Height (m) *&lt;Input name=&quot;ceiling_height_m&quot; value={roomData.ceiling_height_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Sun Exposure *&#10;                        &lt;select name=&quot;sun_exposure_id&quot; value={roomData.sun_exposure_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Sun Exposure&lt;/option&gt;&#10;                            {sunExposures.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Insulation *&#10;                        &lt;select name=&quot;insulation_type_id&quot; value={roomData.insulation_type_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Insulation&lt;/option&gt;&#10;                            {insulationTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Typical Occupants *&lt;Input name=&quot;typical_occupants&quot; value={roomData.typical_occupants} onChange={handleRoomChange} required type=&quot;number&quot; min=&quot;1&quot; /&gt;&lt;/Label&gt;&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                    &lt;h3 className=&quot;font-semibold text-sm mb-2&quot;&gt;Windows&lt;/h3&gt;&#10;                    {roomData.windows.map((window, index) =&gt; (&#10;                        &lt;div key={index} className=&quot;grid grid-cols-3 gap-2 items-end mb-2 p-2 border rounded&quot;&gt;&#10;                            &lt;Label&gt;Width (m)&lt;Input name=&quot;width_m&quot; value={window.width_m} onChange={e =&gt; handleWindowChange(index, e)} type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#10;                            &lt;Label&gt;Height (m)&lt;Input name=&quot;height_m&quot; value={window.height_m} onChange={e =&gt; handleWindowChange(index, e)} type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#10;                            &lt;Button type=&quot;button&quot; variant=&quot;destructive&quot; onClick={() =&gt; removeWindow(index)} disabled={roomData.windows.length &lt;= 1}&gt;Remove&lt;/Button&gt;&#10;                        &lt;/div&gt;&#10;                    ))}&#10;                    &lt;Button type=&quot;button&quot; onClick={addWindow}&gt;+ Add Window&lt;/Button&gt;&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;mt-2 text-sm bg-gray-50 p-3 rounded&quot;&gt;Estimated Room Space: &lt;b&gt;{roomVolume.toFixed(2)} m³&lt;/b&gt; | Estimated Cooling Capacity: &lt;b&gt;{coolingCapacity.toFixed(2)} HP&lt;/b&gt;&lt;/div&gt;&#10;            &lt;/section&gt;&#10;&#10;            &lt;section className=&quot;border rounded p-4 space-y-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;4) Electrical &amp; Preferences&lt;/h2&gt;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                    &lt;Label&gt;Supply Voltage&#10;                        &lt;select name=&quot;supply_voltage_id&quot; value={requestData.supply_voltage_id} onChange={handleRequestChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot;&gt;&#10;                            &lt;option value=&quot;&quot;&gt;Select Voltage&lt;/option&gt;&#10;                            {supplyVoltages.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Available Breaker (A)&lt;Input name=&quot;available_breaker_amps&quot; value={requestData.available_breaker_amps} onChange={handleRequestChange} type=&quot;number&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Preferred Unit Type&#10;                        &lt;select name=&quot;preferred_unit_type_id&quot; value={requestData.preferred_unit_type_id} onChange={handleRequestChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot;&gt;&#10;                            &lt;option value=&quot;&quot;&gt;Select Unit Type&lt;/option&gt;&#10;                            {acUnitTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#10;                        &lt;/select&gt;&#10;                    &lt;/Label&gt;&#10;                    &lt;Label&gt;Budget (₱)&lt;Input name=&quot;budget_php&quot; value={requestData.budget_php} onChange={handleRequestChange} type=&quot;number&quot; /&gt;&lt;/Label&gt;&#10;                &lt;/div&gt;&#10;                &lt;Label&gt;Notes&lt;textarea name=&quot;notes&quot; value={requestData.notes} onChange={handleRequestChange} className=&quot;w-full border rounded p-2&quot; rows={3} placeholder=&quot;Additional preferences or notes...&quot;&gt;&lt;/textarea&gt;&lt;/Label&gt;&#10;            &lt;/section&gt;&#10;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;5) Preferred Schedule&lt;/h2&gt;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;                    &lt;Label&gt;Preferred Date&lt;Input name=&quot;preferred_date&quot; value={requestData.preferred_date} onChange={handleRequestChange} type=&quot;date&quot; /&gt;&lt;/Label&gt;&#10;                    &lt;Label&gt;Preferred Time&lt;Input name=&quot;preferred_time&quot; value={requestData.preferred_time} onChange={handleRequestChange} type=&quot;time&quot; /&gt;&lt;/Label&gt;&#10;                &lt;/div&gt;&#10;            &lt;/section&gt;&#10;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;6) Attachments (optional)&lt;/h2&gt;&#10;                &lt;Label htmlFor=&quot;attachments&quot;&gt;Photos of Room/Window/Outdoor Area&lt;/Label&gt;&#10;                &lt;Input id=&quot;attachments&quot; type=&quot;file&quot; multiple onChange={handleAttachmentChange} /&gt;&#10;                &lt;div className=&quot;flex gap-2 mt-2 flex-wrap&quot;&gt;&#10;                    {attachments.map((file, index) =&gt; (&lt;img key={index} src={URL.createObjectURL(file)} alt={`Preview ${index + 1}`} className=&quot;w-24 h-24 object-cover rounded&quot; /&gt;))}&#10;                &lt;/div&gt;&#10;            &lt;/section&gt;&#10;&#10;            &lt;div className=&quot;flex gap-2 mt-4 justify-end&quot;&gt;&#10;                &lt;Button type=&quot;submit&quot; size=&quot;lg&quot; disabled={isSubmitting}&gt;&#10;                    {isSubmitting ? 'Submitting...' : 'Submit Request'}&#10;                &lt;/Button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/form&gt;&#10;    );&#10;}" />
              <option name="updatedContent" value="// src/modules/customer-management/components/SalesOrderManagementModule.tsx&#13;&#10;&quot;use client&quot;;&#13;&#10;&#13;&#10;import React, { useState, ChangeEvent, FormEvent, useEffect } from 'react';&#13;&#10;import { Input } from '@/components/ui/input';&#13;&#10;import { Button } from '@/components/ui/button';&#13;&#10;import { Label } from &quot;@/components/ui/label&quot;;&#13;&#10;import axios from 'axios';&#13;&#10;import AsyncSelect from 'react-select/async';&#13;&#10;&#13;&#10;// --- Static Data Imports ---&#13;&#10;import provincesData from &quot;@/public/province.json&quot;;&#13;&#10;import citiesData from &quot;@/public/city.json&quot;;&#13;&#10;import barangaysData from &quot;@/public/barangay.json&quot;;&#13;&#10;&#13;&#10;// --- Type Definitions ---&#13;&#10;&#13;&#10;// ✅ FIX: This interface now matches what your form state (clientInfo) actually uses.&#13;&#10;interface ClientInfo {&#13;&#10;    id?: number;&#13;&#10;    complete_name: string; // Changed from first_name/last_name&#13;&#10;    email: string;&#13;&#10;    phone: string;&#13;&#10;    street_address: string;&#13;&#10;    province_state: string; // This will hold the province_code&#13;&#10;    city_municipality: string; // This will hold the city_code&#13;&#10;    barangay: string; // This will hold the brgy_code&#13;&#10;}&#13;&#10;&#13;&#10;interface RoomData {&#13;&#10;    property_type_id: number | '';&#13;&#10;    room_use_id: number | '';&#13;&#10;    length_m: number | '';&#13;&#10;    width_m: number | '';&#13;&#10;    ceiling_height_m: number | '';&#13;&#10;    sun_exposure_id: number | '';&#13;&#10;    insulation_type_id: number | '';&#13;&#10;    typical_occupants: number | '';&#13;&#10;    windows: { width_m: number | ''; height_m: number | '' }[];&#13;&#10;}&#13;&#10;&#13;&#10;interface RequestData {&#13;&#10;    supply_voltage_id: number | '';&#13;&#10;    available_breaker_amps: number | '';&#13;&#10;    preferred_unit_type_id: number | '';&#13;&#10;    budget_php: number | '';&#13;&#10;    notes: string;&#13;&#10;    preferred_date: string;&#13;&#10;    preferred_time: string;&#13;&#10;}&#13;&#10;&#13;&#10;interface DropdownOption { id: number; name: string; }&#13;&#10;&#13;&#10;// ✅ FIX: Define the shape of the customer API data&#13;&#10;interface ApiCustomer {&#13;&#10;    id: number;&#13;&#10;    customer_name: string;&#13;&#10;    customer_email: string;&#13;&#10;    contact_number: string;&#13;&#10;    street_address: string | null;&#13;&#10;    province: string;&#13;&#10;    city: string;&#13;&#10;    brgy: string;&#13;&#10;    [key: string]: any; // Allow other properties&#13;&#10;}&#13;&#10;&#13;&#10;// ✅ FIX: The 'value' is now the full ApiCustomer object&#13;&#10;interface UserOption { label: string; value: ApiCustomer; }&#13;&#10;&#13;&#10;interface Province { province_code: string; province_name: string; }&#13;&#10;interface City { city_code: string; city_name: string; province_code: string; }&#13;&#10;interface Barangay { brgy_code: string; brgy_name: string; city_code: string; }&#13;&#10;&#13;&#10;// --- Main Component ---&#13;&#10;export default function SalesOrderManagementModule() {&#13;&#10;    // --- State Management ---&#13;&#10;    // ✅ FIX: Updated initial state to match the new ClientInfo interface&#13;&#10;    const [clientInfo, setClientInfo] = useState&lt;ClientInfo&gt;({&#13;&#10;        complete_name: '', email: '', phone: '',&#13;&#10;        street_address: '', province_state: '', city_municipality: '', barangay: ''&#13;&#10;    });&#13;&#10;    const [roomData, setRoomData] = useState&lt;RoomData&gt;({&#13;&#10;        property_type_id: '', room_use_id: '', length_m: '', width_m: '', ceiling_height_m: 2.4,&#13;&#10;        sun_exposure_id: '', insulation_type_id: '', typical_occupants: 1,&#13;&#10;        windows: [{ width_m: '', height_m: '' }],&#13;&#10;    });&#13;&#10;    const [requestData, setRequestData] = useState&lt;RequestData&gt;({&#13;&#10;        supply_voltage_id: '', available_breaker_amps: '', preferred_unit_type_id: '',&#13;&#10;        budget_php: '', notes: '', preferred_date: '', preferred_time: '',&#13;&#10;    });&#13;&#10;&#13;&#10;    const [selectedUser, setSelectedUser] = useState&lt;UserOption | null&gt;(null);&#13;&#10;    const [attachments, setAttachments] = useState&lt;File[]&gt;([]);&#13;&#10;    const [isSubmitting, setIsSubmitting] = useState(false);&#13;&#10;&#13;&#10;    // Dropdown options from API&#13;&#10;    const [propertyTypes, setPropertyTypes] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;    const [roomUses, setRoomUses] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;    const [sunExposures, setSunExposures] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;    const [insulationTypes, setInsulationTypes] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;    const [supplyVoltages, setSupplyVoltages] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;    const [acUnitTypes, setAcUnitTypes] = useState&lt;DropdownOption[]&gt;([]);&#13;&#10;&#13;&#10;    // Calculated values&#13;&#10;    const [roomVolume, setRoomVolume] = useState(0);&#13;&#10;    const [coolingCapacity, setCoolingCapacity] = useState(0);&#13;&#10;&#13;&#10;    // Filtered address options&#13;&#10;    const [filteredCities, setFilteredCities] = useState&lt;City[]&gt;([]);&#13;&#10;    const [filteredBarangays, setFilteredBarangays] = useState&lt;Barangay[]&gt;([]);&#13;&#10;&#13;&#10;    // --- Effect Hooks ---&#13;&#10;&#13;&#10;    useEffect(() =&gt; {&#13;&#10;        const length = Number(roomData.length_m) || 0;&#13;&#10;        const width = Number(roomData.width_m) || 0;&#13;&#10;        const height = Number(roomData.ceiling_height_m) || 0;&#13;&#10;        setRoomVolume(length * width * height);&#13;&#10;        // Using a common estimation formula: (L * W * AreaFactor) / 12000 BTU/hr per Ton. Here using a simplified HP calc.&#13;&#10;        setCoolingCapacity((length * width * 600) / 9000);&#13;&#10;    }, [roomData.length_m, roomData.width_m, roomData.ceiling_height_m]);&#13;&#10;&#13;&#10;    useEffect(() =&gt; {&#13;&#10;        const fetchDropdownData = async () =&gt; {&#13;&#10;            try {&#13;&#10;                // Fetch lookups with safe fallbacks so UI doesn't crash if any endpoint is missing&#13;&#10;                const [&#13;&#10;                    roomUseRes, propTypeRes, sunExpRes, insulationRes, voltageRes, unitTypeRes&#13;&#10;                ] = await Promise.all([&#13;&#10;                    axios.get(&quot;/api/lookup/room_uses&quot;).catch(() =&gt; ({ data: [] } as any)),&#13;&#10;                    axios.get(&quot;/api/lookup/property_types&quot;).catch(() =&gt; ({ data: [] } as any)),&#13;&#10;                    axios.get(&quot;/api/lookup/sun_exposures&quot;).catch(() =&gt; ({ data: [] } as any)),&#13;&#10;                    axios.get(&quot;/api/lookup/insulation_types&quot;).catch(() =&gt; ({ data: [] } as any)),&#13;&#10;                    axios.get(&quot;/api/lookup/supply_voltages&quot;).catch(() =&gt; ({ data: [] } as any)),&#13;&#10;                    axios.get(&quot;/api/lookup/ac_unit_types&quot;).catch(() =&gt; ({ data: [] } as any))&#13;&#10;                ]);&#13;&#10;&#13;&#10;                // FIX: Removed .data.data. Use .data directly; add name fallbacks per resource&#13;&#10;                setRoomUses(((roomUseRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.room_use })));&#13;&#10;                setPropertyTypes(((propTypeRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.type })));&#13;&#10;                setSunExposures(((sunExpRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.level })));&#13;&#10;                setInsulationTypes(((insulationRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.type })));&#13;&#10;                setSupplyVoltages(((voltageRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.voltage_range })));&#13;&#10;                setAcUnitTypes(((unitTypeRes as any).data || []).map((item: any) =&gt; ({ id: item.id, name: item.name || item.type })));&#13;&#10;            } catch (error) {&#13;&#10;                console.error(&quot;Failed to fetch dropdown data:&quot;, error);&#13;&#10;                // Keep silent to avoid blocking form usage&#13;&#10;            }&#13;&#10;        };&#13;&#10;        fetchDropdownData();&#13;&#10;    }, []);&#13;&#10;&#13;&#10;    // --- Event Handlers ---&#13;&#10;&#13;&#10;    // ✅ FIX: This function now correctly types the response and returns the full 'user' object as the value.&#13;&#10;    const loadUserOptions = async (inputValue: string): Promise&lt;UserOption[]&gt; =&gt; {&#13;&#10;        if (inputValue.length &lt; 2) return [];&#13;&#10;        try {&#13;&#10;            const response = await axios.get(`/api/lookup/customer?search=${inputValue}`);&#13;&#10;            // FIX: Some routes return an array at root, others wrap in { data }&#13;&#10;            const users = Array.isArray(response.data) ? response.data : (response.data?.data || []);&#13;&#10;            return users.map((user: ApiCustomer) =&gt; ({&#13;&#10;                label: `${user.customer_name} (${user.customer_email})`,&#13;&#10;                value: user // The value is the full customer object&#13;&#10;            }));&#13;&#10;        } catch (error) {&#13;&#10;            console.error(&quot;Failed to fetch users&quot;, error);&#13;&#10;            return [];&#13;&#10;        }&#13;&#10;    };&#13;&#10;&#13;&#10;    // ✅ FIX: This function is entirely replaced.&#13;&#10;    // It no longer makes a new API call.&#13;&#10;    // It uses the data from 'selectedOption.value' to populate all fields and dropdowns.&#13;&#10;    const handleUserSelect = (selectedOption: UserOption | null) =&gt; {&#13;&#10;        setSelectedUser(selectedOption);&#13;&#10;        if (!selectedOption) {&#13;&#10;            clearForm();&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        // No fetch needed! Data is already here.&#13;&#10;        const clientData = selectedOption.value; // clientData is the full ApiCustomer object&#13;&#10;&#13;&#10;        // --- Find Codes from Names ---&#13;&#10;        const allProvinces = provincesData as Province[];&#13;&#10;        const allCities = citiesData as City[];&#13;&#10;        const allBarangays = barangaysData as Barangay[];&#13;&#10;&#13;&#10;        // 1. Find Province Code from Name&#13;&#10;        const provinceCode = allProvinces.find(p =&gt; p.province_name.toLowerCase() === clientData.province?.toLowerCase())?.province_code || &quot;&quot;;&#13;&#10;&#13;&#10;        // 2. Filter Cities based on Province Code&#13;&#10;        const citiesForProvince = provinceCode ? allCities.filter(c =&gt; c.province_code === provinceCode) : [];&#13;&#10;        setFilteredCities(citiesForProvince); // Update dropdown state&#13;&#10;&#13;&#10;        // 3. Find City Code from Name&#13;&#10;        const cityCode = citiesForProvince.find(c =&gt; c.city_name.toLowerCase() === clientData.city?.toLowerCase())?.city_code || &quot;&quot;;&#13;&#10;&#13;&#10;        // 4. Filter Barangays based on City Code&#13;&#10;        const barangaysForCity = cityCode ? allBarangays.filter(b =&gt; b.city_code === cityCode) : [];&#13;&#10;        setFilteredBarangays(barangaysForCity); // Update dropdown state&#13;&#10;&#13;&#10;        // 5. Find Barangay Code from Name&#13;&#10;        const barangayCode = barangaysForCity.find(b =&gt; b.brgy_name.toLowerCase() === clientData.brgy?.toLowerCase())?.brgy_code || &quot;&quot;;&#13;&#10;&#13;&#10;        // --- Set Full Client State ---&#13;&#10;        setClientInfo({&#13;&#10;            id: clientData.id, // Store the ID for updates&#13;&#10;            complete_name: clientData.customer_name || &quot;&quot;,&#13;&#10;            email: clientData.customer_email || &quot;&quot;,&#13;&#10;            phone: clientData.contact_number || &quot;&quot;,&#13;&#10;            street_address: clientData.street_address || &quot;&quot;, // Handle null&#13;&#10;            province_state: provinceCode, // Set the code&#13;&#10;            city_municipality: cityCode, // Set the code&#13;&#10;            barangay: barangayCode, // Set the code&#13;&#10;        });&#13;&#10;    };&#13;&#10;&#13;&#10;    const clearForm = () =&gt; {&#13;&#10;        // ✅ FIX: Matches the new ClientInfo state&#13;&#10;        setClientInfo({ complete_name: '', email: '', phone: '', street_address: '', province_state: '', city_municipality: '', barangay: '' });&#13;&#10;        setRoomData({ property_type_id: '', room_use_id: '', length_m: '', width_m: '', ceiling_height_m: 2.4, sun_exposure_id: '', insulation_type_id: '', typical_occupants: 1, windows: [{ width_m: '', height_m: '' }]});&#13;&#10;        setRequestData({ supply_voltage_id: '', available_breaker_amps: '', preferred_unit_type_id: '', budget_php: '', notes: '', preferred_date: '', preferred_time: '' });&#13;&#10;        setSelectedUser(null);&#13;&#10;        setAttachments([]);&#13;&#10;        setFilteredCities([]);&#13;&#10;        setFilteredBarangays([]);&#13;&#10;    };&#13;&#10;&#13;&#10;    const handleProvinceChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; {&#13;&#10;        const provinceCode = e.target.value;&#13;&#10;        setClientInfo(prev =&gt; ({ ...prev, province_state: provinceCode, city_municipality: &quot;&quot;, barangay: &quot;&quot; }));&#13;&#10;        setFilteredCities((citiesData as City[]).filter(city =&gt; city.province_code === provinceCode));&#13;&#10;        setFilteredBarangays([]);&#13;&#10;    };&#13;&#10;&#13;&#10;    const handleCityChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; {&#13;&#10;        const cityCode = e.target.value;&#13;&#10;        setClientInfo(prev =&gt; ({ ...prev, city_municipality: cityCode, barangay: &quot;&quot; }));&#13;&#10;        setFilteredBarangays((barangaysData as Barangay[]).filter(barangay =&gt; barangay.city_code === cityCode));&#13;&#10;    };&#13;&#10;&#13;&#10;    const handleClientInputChange = (e: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; setClientInfo(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#13;&#10;    const handleClientSelectChange = (e: ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; setClientInfo(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#13;&#10;    const handleRoomChange = (e: ChangeEvent&lt;HTMLInputElement | HTMLSelectElement&gt;) =&gt; setRoomData(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#13;&#10;    const handleRequestChange = (e: ChangeEvent&lt;HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement&gt;) =&gt; setRequestData(prev =&gt; ({ ...prev, [e.target.name]: e.target.value }));&#13;&#10;    const handleWindowChange = (index: number, e: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {&#13;&#10;        const { name, value } = e.target;&#13;&#10;        const updatedWindows = roomData.windows.map((win, i) =&gt; i === index ? { ...win, [name]: value === '' ? '' : parseFloat(value) } : win);&#13;&#10;        setRoomData(prev =&gt; ({ ...prev, windows: updatedWindows }));&#13;&#10;    };&#13;&#10;    const addWindow = () =&gt; setRoomData(prev =&gt; ({ ...prev, windows: [...prev.windows, { width_m: '', height_m: '' }] }));&#13;&#10;    const removeWindow = (index: number) =&gt; { if (roomData.windows.length &gt; 1) setRoomData(prev =&gt; ({ ...prev, windows: prev.windows.filter((_, i) =&gt; i !== index)})); };&#13;&#10;    const handleAttachmentChange = (event: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; { if (event.target.files) setAttachments(Array.from(event.target.files)); };&#13;&#10;&#13;&#10;    // --- Form Submission Logic ---&#13;&#10;    const handleSubmit = async (e: FormEvent) =&gt; {&#13;&#10;        e.preventDefault();&#13;&#10;        setIsSubmitting(true);&#13;&#10;&#13;&#10;        // --- Find full string names for address parts for the payload ---&#13;&#10;        const provinceName = (provincesData as Province[]).find(p =&gt; p.province_code === clientInfo.province_state)?.province_name || '';&#13;&#10;        const cityName = (citiesData as City[]).find(c =&gt; c.city_code === clientInfo.city_municipality)?.city_name || '';&#13;&#10;        const barangayName = (barangaysData as Barangay[]).find(b =&gt; b.brgy_code === clientInfo.barangay)?.brgy_name || '';&#13;&#10;&#13;&#10;        if (!provinceName || !cityName || !barangayName) {&#13;&#10;            alert(&quot;Please ensure a valid Province, City, and Barangay are selected.&quot;);&#13;&#10;            setIsSubmitting(false);&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        try {&#13;&#10;            // --- STEP 1: Create or Update Customer ---&#13;&#10;            let customerId: number;&#13;&#10;            const customerPayload = {&#13;&#10;                customer_name: clientInfo.complete_name,&#13;&#10;                contact_number: clientInfo.phone,&#13;&#10;                customer_email: clientInfo.email,&#13;&#10;                street_address: clientInfo.street_address,&#13;&#10;                province: provinceName,&#13;&#10;                city: cityName,&#13;&#10;                brgy: barangayName,&#13;&#10;            };&#13;&#10;&#13;&#10;            if (clientInfo.id) {&#13;&#10;                // UPDATE existing customer&#13;&#10;                const response = await axios.patch(`/api/customer/${clientInfo.id}`, customerPayload);&#13;&#10;                customerId = response.data.data.id;&#13;&#10;            } else {&#13;&#10;                // CREATE new customer&#13;&#10;                const response = await axios.post(&quot;/api/customer&quot;, customerPayload);&#13;&#10;                customerId = response.data.data.id;&#13;&#10;            }&#13;&#10;&#13;&#10;            if (!customerId) throw new Error(&quot;Could not save customer information.&quot;);&#13;&#10;&#13;&#10;            console.log(&quot;Customer ID:&quot;, customerId); // Log the customer ID for debugging&#13;&#10;&#13;&#10;            // --- STEP 2: Create Installation Request ---&#13;&#10;            // Fetch existing installation requests to determine the next ir_code&#13;&#10;            const existingRequestsResponse = await axios.get(&quot;/api/installation_requests?fields=ir_code&quot;);&#13;&#10;            const existingRequests = existingRequestsResponse.data.data || [];&#13;&#10;&#13;&#10;            // Determine the highest ir_code and generate the next one&#13;&#10;            const highestIrCode = existingRequests&#13;&#10;                .map((req: { ir_code: string }) =&gt; parseInt(req.ir_code?.split('-')[1] || '0', 10))&#13;&#10;                .filter((num: number) =&gt; !isNaN(num)) // Fix: Add explicit type to num in filter&#13;&#10;                .reduce((max: number, num: number) =&gt; Math.max(max, num), 0); // Fix: Add explicit type to max and num in reduce&#13;&#10;&#13;&#10;            const nextIrCode = `SO-${(highestIrCode + 1).toString().padStart(4, '0')}`;&#13;&#10;&#13;&#10;            // Add the generated ir_code to the payload&#13;&#10;            const installationRequestPayload = {&#13;&#10;                client_id: customerId,&#13;&#10;                supply_voltage_id: requestData.supply_voltage_id || null,&#13;&#10;                available_breaker_amps: requestData.available_breaker_amps || null,&#13;&#10;                preferred_unit_type_id: requestData.preferred_unit_type_id || null,&#13;&#10;                budget_php: requestData.budget_php || null,&#13;&#10;                notes: requestData.notes,&#13;&#10;                preferred_date: requestData.preferred_date || null,&#13;&#10;                preferred_time: requestData.preferred_time || null,&#13;&#10;                room_data: {&#13;&#10;                    ...roomData,&#13;&#10;                    windows: roomData.windows.filter(w =&gt; w.width_m &amp;&amp; w.height_m) // Clean up empty windows&#13;&#10;                },&#13;&#10;                ir_code: nextIrCode // Include the generated ir_code&#13;&#10;            };&#13;&#10;&#13;&#10;            console.log(&quot;Generated ir_code:&quot;, nextIrCode); // Log the generated ir_code for debugging&#13;&#10;            console.log(&quot;Installation Request Payload:&quot;, installationRequestPayload); // Log the payload for debugging&#13;&#10;&#13;&#10;            const requestResponse = await axios.post(&quot;/api/installation_requests&quot;, installationRequestPayload);&#13;&#10;            const newRequestId = requestResponse.data.data.id;&#13;&#10;            console.log(&quot;Created installation request:&quot;, requestResponse.data.data);&#13;&#10;&#13;&#10;            if (!newRequestId) throw new Error(&quot;Could not create the installation request.&quot;);&#13;&#10;&#13;&#10;            // --- STEP 3 &amp; 4: Upload and Link Attachments ---&#13;&#10;            if (attachments.length &gt; 0) {&#13;&#10;                const uploadPromises = attachments.map(file =&gt; {&#13;&#10;                    const formData = new FormData();&#13;&#10;                    formData.append('file', file);&#13;&#10;                    return axios.post(&quot;/api/files&quot;, formData, {&#13;&#10;                        headers: { 'Content-Type': 'multipart/form-data' }&#13;&#10;                    });&#13;&#10;                });&#13;&#10;&#13;&#10;                const uploadResults = await Promise.all(uploadPromises);&#13;&#10;                console.log(&quot;File upload successful:&quot;, uploadResults);&#13;&#10;&#13;&#10;                const attachmentPayloads = uploadResults.map((result, index) =&gt; {&#13;&#10;                    const uploadedFile = result.data.data;&#13;&#10;                    const originalFile = attachments[index];&#13;&#10;                    return {&#13;&#10;                        request_id: newRequestId,&#13;&#10;                        file_name: originalFile.name,&#13;&#10;                        file_path: uploadedFile.id,&#13;&#10;                        file_type: originalFile.type,&#13;&#10;                        file_size_bytes: originalFile.size,&#13;&#10;                    };&#13;&#10;                });&#13;&#10;&#13;&#10;                await axios.post(&quot;/api/attachments&quot;, attachmentPayloads);&#13;&#10;                console.log(&quot;Attachment records created.&quot;);&#13;&#10;            }&#13;&#10;&#13;&#10;            // --- SUCCESS ---&#13;&#10;            alert(&quot;Request submitted successfully!&quot;);&#13;&#10;            clearForm();&#13;&#10;&#13;&#10;        } catch (error: any) {&#13;&#10;            console.error(&quot;Submission failed:&quot;, error);&#13;&#10;            const errorMessage = axios.isAxiosError(error)&#13;&#10;                ? error.response?.data?.errors?.[0]?.message || error.message&#13;&#10;                : error.message;&#13;&#10;            alert(`An error occurred: ${errorMessage}`);&#13;&#10;        } finally {&#13;&#10;            setIsSubmitting(false);&#13;&#10;        }&#13;&#10;    };&#13;&#10;&#13;&#10;    // --- JSX Return ---&#13;&#10;    return (&#13;&#10;        &lt;form className=&quot;space-y-6 p-6 bg-white rounded shadow-lg&quot; onSubmit={handleSubmit}&gt;&#13;&#10;&#13;&#10;            &lt;div className=&quot;space-y-2 p-4 border rounded bg-slate-50&quot;&gt;&#13;&#10;                &lt;Label htmlFor=&quot;clientSearch&quot; className=&quot;font-semibold&quot;&gt;Search Existing Client&lt;/Label&gt;&#13;&#10;                &lt;AsyncSelect id=&quot;clientSearch&quot; cacheOptions defaultOptions loadOptions={loadUserOptions} onChange={handleUserSelect} value={selectedUser} placeholder=&quot;Type a name or email to search...&quot; isClearable instanceId=&quot;clientSearch&quot; /&gt;&#13;&#10;                &lt;Button type=&quot;button&quot; onClick={clearForm} variant=&quot;outline&quot; className=&quot;mt-2&quot;&gt;Clear Form / New Client&lt;/Button&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;1) Client Information&lt;/h2&gt;&#13;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#13;&#10;                    {/* ✅ FIX: Field name is 'complete_name' */}&#13;&#10;                    &lt;Label&gt;Complete Name *&lt;Input name=&quot;complete_name&quot; value={clientInfo.complete_name || ''} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Email&lt;Input name=&quot;email&quot; value={clientInfo.email} onChange={handleClientInputChange} type=&quot;email&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Phone *&lt;Input name=&quot;phone&quot; value={clientInfo.phone} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;2) Installation Address&lt;/h2&gt;&#13;&#10;                &lt;Label className=&quot;block w-full mb-2&quot;&gt;Street Address *&lt;Input name=&quot;street_address&quot; value={clientInfo.street_address} onChange={handleClientInputChange} required /&gt;&lt;/Label&gt;&#13;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-2&quot;&gt;&#13;&#10;                    &lt;Label&gt;Province *&#13;&#10;                        &lt;select name=&quot;province_state&quot; value={clientInfo.province_state} onChange={handleProvinceChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#13;&#10;                            &lt;option value=&quot;&quot;&gt;Select Province&lt;/option&gt;{(provincesData as Province[]).map((p, index) =&gt; (&lt;option key={`${p.province_code}-${index}`} value={p.province_code}&gt;{p.province_name}&lt;/option&gt;))}&lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;City/Municipality *&#13;&#10;                        &lt;select name=&quot;city_municipality&quot; value={clientInfo.city_municipality} onChange={handleCityChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required disabled={!clientInfo.province_state}&gt;&#13;&#10;                            &lt;option value=&quot;&quot;&gt;Select City/Municipality&lt;/option&gt;&#13;&#10;                            {filteredCities.map(c =&gt; &lt;option key={c.city_code} value={c.city_code}&gt;{c.city_name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Barangay *&#13;&#10;                        &lt;select name=&quot;barangay&quot; value={clientInfo.barangay} onChange={handleClientSelectChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required disabled={!clientInfo.city_municipality}&gt;&#13;&#10;                            &lt;option value=&quot;&quot;&gt;Select Barangay&lt;/option&gt;&#13;&#10;                            {filteredBarangays.map(b =&gt; &lt;option key={b.brgy_code} value={b.brgy_code}&gt;{b.brgy_name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            {/* ... (Rest of your component remains unchanged) ... */}&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4 space-y-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;3) Property &amp; Room Details&lt;/h2&gt;&#13;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#13;&#10;                    &lt;Label&gt;Property Type *&#13;&#10;                        &lt;select name=&quot;property_type_id&quot; value={roomData.property_type_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#13;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Property Type&lt;/option&gt;&#13;&#10;                            {propertyTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Room Use *&#13;&#10;                        &lt;select name=&quot;room_use_id&quot; value={roomData.room_use_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#13;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Room Use&lt;/option&gt;&#13;&#10;                            {roomUses.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Room Length (m) *&lt;Input name=&quot;length_m&quot; value={roomData.length_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Room Width (m) *&lt;Input name=&quot;width_m&quot; value={roomData.width_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Ceiling Height (m) *&lt;Input name=&quot;ceiling_height_m&quot; value={roomData.ceiling_height_m} onChange={handleRoomChange} required type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Sun Exposure *&#13;&#10;                        &lt;select name=&quot;sun_exposure_id&quot; value={roomData.sun_exposure_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#13;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Sun Exposure&lt;/option&gt;&#13;&#10;                            {sunExposures.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Insulation *&#13;&#10;                        &lt;select name=&quot;insulation_type_id&quot; value={roomData.insulation_type_id} onChange={handleRoomChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot; required&gt;&#13;&#10;                            &lt;option value=&quot;&quot; disabled&gt;Select Insulation&lt;/option&gt;&#13;&#10;                            {insulationTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Typical Occupants *&lt;Input name=&quot;typical_occupants&quot; value={roomData.typical_occupants} onChange={handleRoomChange} required type=&quot;number&quot; min=&quot;1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;                &lt;div&gt;&#13;&#10;                    &lt;h3 className=&quot;font-semibold text-sm mb-2&quot;&gt;Windows&lt;/h3&gt;&#13;&#10;                    {roomData.windows.map((window, index) =&gt; (&#13;&#10;                        &lt;div key={index} className=&quot;grid grid-cols-3 gap-2 items-end mb-2 p-2 border rounded&quot;&gt;&#13;&#10;                            &lt;Label&gt;Width (m)&lt;Input name=&quot;width_m&quot; value={window.width_m} onChange={e =&gt; handleWindowChange(index, e)} type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                            &lt;Label&gt;Height (m)&lt;Input name=&quot;height_m&quot; value={window.height_m} onChange={e =&gt; handleWindowChange(index, e)} type=&quot;number&quot; step=&quot;0.1&quot; /&gt;&lt;/Label&gt;&#13;&#10;                            &lt;Button type=&quot;button&quot; variant=&quot;destructive&quot; onClick={() =&gt; removeWindow(index)} disabled={roomData.windows.length &lt;= 1}&gt;Remove&lt;/Button&gt;&#13;&#10;                        &lt;/div&gt;&#13;&#10;                    ))}&#13;&#10;                    &lt;Button type=&quot;button&quot; onClick={addWindow}&gt;+ Add Window&lt;/Button&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;                &lt;div className=&quot;mt-2 text-sm bg-gray-50 p-3 rounded&quot;&gt;Estimated Room Space: &lt;b&gt;{roomVolume.toFixed(2)} m³&lt;/b&gt; | Estimated Cooling Capacity: &lt;b&gt;{coolingCapacity.toFixed(2)} HP&lt;/b&gt;&lt;/div&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4 space-y-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;4) Electrical &amp; Preferences&lt;/h2&gt;&#13;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#13;&#10;                    &lt;Label&gt;Supply Voltage&#13;&#10;                        &lt;select name=&quot;supply_voltage_id&quot; value={requestData.supply_voltage_id} onChange={handleRequestChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot;&gt;&#13;&#10;                            &lt;option value=&quot;&quot;&gt;Select Voltage&lt;/option&gt;&#13;&#10;                            {supplyVoltages.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Available Breaker (A)&lt;Input name=&quot;available_breaker_amps&quot; value={requestData.available_breaker_amps} onChange={handleRequestChange} type=&quot;number&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Preferred Unit Type&#13;&#10;                        &lt;select name=&quot;preferred_unit_type_id&quot; value={requestData.preferred_unit_type_id} onChange={handleRequestChange} className=&quot;border rounded p-2 h-10 w-full mt-1&quot;&gt;&#13;&#10;                            &lt;option value=&quot;&quot;&gt;Select Unit Type&lt;/option&gt;&#13;&#10;                            {acUnitTypes.map(opt =&gt; &lt;option key={opt.id} value={opt.id}&gt;{opt.name}&lt;/option&gt;)}&#13;&#10;                        &lt;/select&gt;&#13;&#10;                    &lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Budget (₱)&lt;Input name=&quot;budget_php&quot; value={requestData.budget_php} onChange={handleRequestChange} type=&quot;number&quot; /&gt;&lt;/Label&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;                &lt;Label&gt;Notes&lt;textarea name=&quot;notes&quot; value={requestData.notes} onChange={handleRequestChange} className=&quot;w-full border rounded p-2&quot; rows={3} placeholder=&quot;Additional preferences or notes...&quot;&gt;&lt;/textarea&gt;&lt;/Label&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;5) Preferred Schedule&lt;/h2&gt;&#13;&#10;                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#13;&#10;                    &lt;Label&gt;Preferred Date&lt;Input name=&quot;preferred_date&quot; value={requestData.preferred_date} onChange={handleRequestChange} type=&quot;date&quot; /&gt;&lt;/Label&gt;&#13;&#10;                    &lt;Label&gt;Preferred Time&lt;Input name=&quot;preferred_time&quot; value={requestData.preferred_time} onChange={handleRequestChange} type=&quot;time&quot; /&gt;&lt;/Label&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            &lt;section className=&quot;border rounded p-4&quot;&gt;&#13;&#10;                &lt;h2 className=&quot;font-bold mb-2&quot;&gt;6) Attachments (optional)&lt;/h2&gt;&#13;&#10;                &lt;Label htmlFor=&quot;attachments&quot;&gt;Photos of Room/Window/Outdoor Area&lt;/Label&gt;&#13;&#10;                &lt;Input id=&quot;attachments&quot; type=&quot;file&quot; multiple onChange={handleAttachmentChange} /&gt;&#13;&#10;                &lt;div className=&quot;flex gap-2 mt-2 flex-wrap&quot;&gt;&#13;&#10;                    {attachments.map((file, index) =&gt; (&lt;img key={index} src={URL.createObjectURL(file)} alt={`Preview ${index + 1}`} className=&quot;w-24 h-24 object-cover rounded&quot; /&gt;))}&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/section&gt;&#13;&#10;&#13;&#10;            &lt;div className=&quot;flex gap-2 mt-4 justify-end&quot;&gt;&#13;&#10;                &lt;Button type=&quot;submit&quot; size=&quot;lg&quot; disabled={isSubmitting}&gt;&#13;&#10;                    {isSubmitting ? 'Submitting...' : 'Submit Request'}&#13;&#10;                &lt;/Button&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;        &lt;/form&gt;&#13;&#10;    );&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>